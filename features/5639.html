<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Feature 5639 - Code::Blocks History</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="navbar navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://www.codeblocks.org/">Code::Blocks</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../index.html">Home</a></li>
            <li><a href="../bugs.html">Bugs</a></li>
            <li class="active"><a href="../features.html">Features</a></li>
            <li><a href="../patches.html">Patches</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container" role="main">
      <div class="row">
        <div class="col-sm-8">
          <h3>Feature #5639 <small>2013-04-01 12:01:00</small></h3>
          <h4>kalith</h4>
          <p class="lead">"Toggle comment": do not mix un/comment</p>
          <p>Sorry for this horrible title, but the character limit is ridiculous...</p>
          <p>Currently, "toggle comment" acts on each of the selected lines individually. This is most often not the desired action. Indeed, one would rather wants to comment/uncomment a block of code as a whole.</p>
          <p>My suggestion: the command should first detect if any of the selected lines are uncommented. If so, then comment out the whole selection (adding comment tags to the lines that were already commented too). Else, all the lines are commented: uncomment them (removing one comment tag on each line).</p>
          <p>This allows codes like:</p>
          <p>int i = 0;      // This is a great integer      int j = i;</p>
          <p>to be commented as:</p>
          <p>//    int i = 0;  //    // This is a great integer  //    int j = i;</p>
          <p>while the current version would produce:</p>
          <p>//    int i = 0;       This is a great integer  //    int j = i;</p>
          <p>which makes no sense.</p>
        </div>
        <div class="col-sm-4">
          <dl class="dl-horizontal">
            <dt>Category</dt><dd>Interface</dd>
            <dt>Status</dt><dd>Closed</dd>
            <dt>Close date</dt><dd>2013-04-26 02:57:00</dd>
            <dt>Assigned to</dt><dd>&nbsp;</dd>
          </dl>
        </div>
      </div>
      <h4 class="page-header">History</h4>
      <div class="panel panel-default">
        <div class="panel-heading">kalith 2013-04-01 12:10:00</div>
        <div class="panel-body">
          <p>Untested patch, so you get the idea:</p>
          <p>--- main_base.cpp	2013-04-01 14:01:14 +0200 +++ main.cpp	2013-04-01 14:08:03 +0200 @@ -3525,16 +3525,31 @@ void MainFrame::OnEditToggleCommentSelec                  --endLine;              }   +            bool doComment = false;              while( curLine &lt;= endLine )              { -                // For each line: If it's commented, uncomment. Otherwise, comment. +                // Check is any of the selected lines is commented                  wxString strLine = stc-&gt;GetLine( curLine );                  int commentPos = strLine.Strip( wxString::leading ).Find( comment );                    if ( -1 == commentPos || commentPos &gt; 0 ) +                { +                    // If at least one line is not commented, then comment out the whole selection, +                    // else uncomment it. +                    doComment = true; +                    break; +                } +                ++curLine; +            } + +            curLine = startLine; +            while( curLine &lt;= endLine ) +            { +                if ( doComment )                      stc-&gt;InsertText( stc-&gt;PositionFromLine( curLine ), comment );                  else                  {      // we know the comment is there (maybe preceded by white space) +                    wxString strLine = stc-&gt;GetLine( curLine );                      int Pos = strLine.Find(comment);                      int start = stc-&gt;PositionFromLine( curLine ) + Pos;                      int end = start + comment.Length();</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">kalith 2013-04-01 12:13:00</div>
        <div class="panel-body">
          <p>Sorry for the mess, I have uploaded the patch here: <a href="https://developer.berlios.de/patch/index.php?func=detailpatch&amp;patch_id=3449&amp;g">https://developer.berlios.de/patch/index.php?func=detailpatch&amp;patch_id=3449&amp;g</a> roup_id=5358</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">alpha0010 2013-04-26 02:57:00</div>
        <div class="panel-body">
          <p>Patch 3449 is committed.</p>
        </div>
      </div>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
  </body>
</html>