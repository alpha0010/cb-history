<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Patch 2162 - Code::Blocks History</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">

    <link rel="stylesheet" href="../pygments.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="navbar navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://www.codeblocks.org/">Code::Blocks</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../index.html">Home</a></li>
            <li><a href="../bugs.html">Bugs</a></li>
            <li><a href="../features.html">Features</a></li>
            <li class="active"><a href="../patches.html">Patches</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container" role="main">
      <div class="row">
        <div class="col-sm-8">
          <h3>Patch #2162 <small>2007-08-28 12:16</small></h3>
          <h4>olipfei</h4>
          Patch for <a href="../features/3547.html" data-toggle="tooltip" title="Insert open file into project">Feature Request #3547</a>
          <dl class="dl-horizontal">
            <dt>Download</dt>
            <dd><a href="2162-Patch_for_Feat.patch">2162-Patch_for_Feat.patch</a> (7.1 KB)</dd>
          </dl>
        </div>
        <div class="col-sm-4">
          <dl class="dl-horizontal">
            <dt>Category</dt><dd>Application::FeatureAdd</dd>
            <dt>Status</dt><dd>Accepted</dd>
            <dt>Close date</dt><dd>2009-08-24 07:33 <a href="http://cb.biplab.in/websvn/log.php?sr=5742"><span class="glyphicon glyphicon-link"></span></a></dd>
            <dt>Assigned to</dt><dd>mortenmacfly</dd>
          </dl>
        </div>
      </div>
      <div class="highlight"><pre class="pre-scrollable"><span class="gh">Index: src/include/editormanager.h</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/include/editormanager.h    (Revision 5294)</span>
<span class="gi">+++ src/include/editormanager.h    (Arbeitskopie)</span>
<span class="gu">@@ -136,6 +136,8 @@</span>
         void OnSwapHeaderSource(wxCommandEvent&amp; event);
         void OnTabPosition(wxCommandEvent&amp; event);
         void OnProperties(wxCommandEvent&amp; event);
<span class="gi">+        void OnAddFileToProject(wxCommandEvent&amp; event);</span>
<span class="gi">+        void OnRemoveFileFromProject(wxCommandEvent&amp; event);</span>
         void OnAppDoneStartup(wxCommandEvent&amp; event);
         void OnAppStartShutdown(wxCommandEvent&amp; event);
         void OnUpdateUI(wxUpdateUIEvent&amp; event);
<span class="gh">Index: src/sdk/cbeditor.cpp</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/sdk/cbeditor.cpp    (Revision 5294)</span>
<span class="gi">+++ src/sdk/cbeditor.cpp    (Arbeitskopie)</span>
<span class="gu">@@ -398,6 +398,8 @@</span>
 const int idUnsplit = wxNewId();
 const int idConfigureEditor = wxNewId();
 const int idProperties = wxNewId();
<span class="gi">+const int idAddFileToProject = wxNewId();</span>
<span class="gi">+const int idRemoveFileFromProject = wxNewId();</span>
 
 const int idBookmarkAdd = wxNewId();
 const int idBookmarkRemove = wxNewId();
<span class="gu">@@ -431,6 +433,8 @@</span>
     EVT_MENU(idFoldingToggleCurrent, cbEditor::OnContextMenuEntry)
     EVT_MENU(idConfigureEditor, cbEditor::OnContextMenuEntry)
     EVT_MENU(idProperties, cbEditor::OnContextMenuEntry)
<span class="gi">+    EVT_MENU(idAddFileToProject, cbEditor::OnContextMenuEntry)</span>
<span class="gi">+    EVT_MENU(idRemoveFileFromProject, cbEditor::OnContextMenuEntry)</span>
     EVT_MENU(idBookmarkAdd, cbEditor::OnContextMenuEntry)
     EVT_MENU(idBookmarkRemove, cbEditor::OnContextMenuEntry)
     EVT_MENU(idBreakpointAdd, cbEditor::OnContextMenuEntry)
<span class="gu">@@ -662,13 +666,13 @@</span>
         else
             m_Shortname = m_pProjectFile-&gt;file.GetFullName();
         SetEditorTitle(m_Shortname);
<span class="gi">+</span>
<span class="gi">+        if (!wxFileExists(m_Filename))</span>
<span class="gi">+            m_pProjectFile-&gt;SetFileState(fvsMissing);</span>
<span class="gi">+        else if (!wxFile::Access(m_Filename.c_str(), wxFile::write)) // readonly</span>
<span class="gi">+            m_pProjectFile-&gt;SetFileState(fvsReadOnly);</span>
     }
 
<span class="gd">-    if (!wxFileExists(m_Filename))</span>
<span class="gd">-        m_pProjectFile-&gt;SetFileState(fvsMissing);</span>
<span class="gd">-    else if (!wxFile::Access(m_Filename.c_str(), wxFile::write)) // readonly</span>
<span class="gd">-        m_pProjectFile-&gt;SetFileState(fvsReadOnly);</span>
<span class="gd">-</span>
 #if 0
     wxString dbg;
     dbg &lt;&lt; _T(&quot;[ed] Filename: &quot;) &lt;&lt; GetFilename() &lt;&lt; _T(&#39;\n&#39;);
<span class="gu">@@ -1418,6 +1422,9 @@</span>
     fname.Assign(m_Filename);
     m_Shortname = fname.GetFullName();
     SetEditorTitle(m_Shortname);
<span class="gi">+    // invalidate m_pProjectFile, because if kept, it would point to the ProjectFile with old name and</span>
<span class="gi">+    // cause ProjectManager::RemoveFileFromProject called via context menu to crash</span>
<span class="gi">+    SetProjectFile(0); </span>
     //Manager::Get()-&gt;GetLogManager()-&gt;Log(mltDevDebug, &quot;Filename=%s\nShort=%s&quot;, m_Filename.c_str(), m_Shortname.c_str());
     m_IsOK = true;
     SetModified(true);
<span class="gu">@@ -2239,6 +2246,15 @@</span>
             popup-&gt;Append(idConfigureEditor, _(&quot;Configure editor...&quot;));
         popup-&gt;Append(idProperties, _(&quot;Properties...&quot;));
 
<span class="gi">+        if (Manager::Get()-&gt;GetProjectManager()-&gt;GetActiveProject()) // project must be open</span>
<span class="gi">+        {</span>
<span class="gi">+            popup-&gt;AppendSeparator();</span>
<span class="gi">+</span>
<span class="gi">+            if (m_pProjectFile)</span>
<span class="gi">+                popup-&gt;Append(idRemoveFileFromProject, _(&quot;Remove file from project&quot;));</span>
<span class="gi">+            else</span>
<span class="gi">+                popup-&gt;Append(idAddFileToProject, _(&quot;Add file to active project&quot;));</span>
<span class="gi">+        }</span>
         // remove &quot;Insert/Empty&quot; if more than one entry
         wxMenu* insert = 0;
         wxMenuItem* insertitem = popup-&gt;FindItem(idInsert);
<span class="gu">@@ -2467,6 +2483,27 @@</span>
             dlg.ShowModal();
         }
     }
<span class="gi">+    else if (id == idAddFileToProject)</span>
<span class="gi">+    {</span>
<span class="gi">+        cbProject *prj = Manager::Get()-&gt;GetProjectManager()-&gt;GetActiveProject();</span>
<span class="gi">+</span>
<span class="gi">+        wxArrayInt targets;</span>
<span class="gi">+        if (Manager::Get()-&gt;GetProjectManager()-&gt;AddFileToProject(m_Filename, prj, targets) != 0)</span>
<span class="gi">+        {</span>
<span class="gi">+            ProjectFile* pf = prj-&gt;GetFileByFilename(m_Filename, false);</span>
<span class="gi">+            SetProjectFile(pf);</span>
<span class="gi">+            Manager::Get()-&gt;GetProjectManager()-&gt;RebuildTree();</span>
<span class="gi">+        }</span>
<span class="gi">+    }</span>
<span class="gi">+    else if (id == idRemoveFileFromProject)</span>
<span class="gi">+    {</span>
<span class="gi">+        if (m_pProjectFile)</span>
<span class="gi">+        {</span>
<span class="gi">+            cbProject *prj = m_pProjectFile-&gt;GetParentProject();</span>
<span class="gi">+            Manager::Get()-&gt;GetProjectManager()-&gt;RemoveFileFromProject(m_pProjectFile, prj);</span>
<span class="gi">+            Manager::Get()-&gt;GetProjectManager()-&gt;RebuildTree();</span>
<span class="gi">+        }</span>
<span class="gi">+    }</span>
     else if (id == idBreakpointAdd)
         AddBreakpoint(m_pData-&gt;m_LastMarginMenuLine);
     else if (id == idBreakpointEdit)
<span class="gh">Index: src/sdk/editormanager.cpp</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/sdk/editormanager.cpp    (Revision 5294)</span>
<span class="gi">+++ src/sdk/editormanager.cpp    (Arbeitskopie)</span>
<span class="gu">@@ -105,6 +105,8 @@</span>
 static const int idNBTabTop = wxNewId();
 static const int idNBTabBottom = wxNewId();
 static const int idNBProperties = wxNewId();
<span class="gi">+static const int idNBAddFileToProject = wxNewId();</span>
<span class="gi">+static const int idNBRemoveFileFromProj</span>
<em><strong>file truncated...</strong></em>
</pre></div>

      <h4 class="page-header">History</h4>
      <div class="panel panel-default">
        <div class="panel-heading">olipfei 2007-08-28 12:28</div>
        <div class="panel-body">
          <p>New item 'Add file to active project' in EditorManager and cbEditor popup menus. I actually also added 'Remove file from project' functionality to these menus, but to this purpose I had to insert a function to the public interface of class ProjectManager which I don't know if I'm allowed to do so as 'external' developer. It would be fine if someone could give me a hint how to implement a more suitable and generic version of ProjectManager::RemoveFileFromProject, compared with AddFileToProject.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">olipfei 2007-08-28 12:33</div>
        <div class="panel-body">
          <p>Forgot to remove two comments from my other experiments, thus uploaded corrected patch.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">rhf 2008-05-01 16:51</div>
        <div class="panel-body">
          <p>I just became aware of this patch and would like to experiment with it. So far I have not been able to apply the patch. Maybe my procedure is wrong:</p>
          <p>Open View Raw Patch above and save file in src directory, with .patch extension.</p>
          <p>Right-click file-&gt;TortoiseSVN-&gt;Apply patch....</p>
          <p>This gives error "An unknown line type was found in line 109!".</p>
          <p>Any suggestions?</p>
          <p>Thanks.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">olipfei 2008-05-01 18:29</div>
        <div class="panel-body">
          <p>The procedure seems fine (though I have no experience with TortoiseSVN), but the patch is definitely too old. I wrote it with respect to revision 4403, now CB is at revision &gt;5000. I will soon upload an adapted patch, but cannot do so before next week.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">rhf 2008-05-02 00:44</div>
        <div class="panel-body">
          <p>Great. I look forward to experimenting with your new patch. This is a MSVC feature that I have really missed in CodeBlocks.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">olipfei 2008-05-28 18:57</div>
        <div class="panel-body">
          <p>Sorry for the (expectable ;-) delay! I have adapted the patch   to revision 5081. Can you please crosscheck if it works now (applying the patch and compiling)?</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">rhf 2008-05-29 02:16</div>
        <div class="panel-body">
          <p>I just noticed your updated patch. I will definitely try it out, but it will probably be this weekend before I can get to it. Thanks.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">rhf 2008-05-31 15:30</div>
        <div class="panel-body">
          <p>I applied the patch (Windows XP) and it appears to work as you intended. Good work!</p>
          <p>However, it does not do quite what I had hoped. I often have a project file, say a header, open in the editor and decide I need another file. I do a File-&gt;Save as and enter the new file name, which opens in the editor. I then want to add this to the project, but the context menu continues with the option "Remove file from project" . This new file is not yet in the project and two attempts to remove it will cause CB to crash. If you can fix this, I think this would be an excellent additional  feature for CB.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">olipfei 2008-06-11 20:26</div>
        <div class="panel-body">
          <p>Uploaded corrected patch which now also fixes a minor flaw in cbEditor::SaveAs that causes another part of the patch to crash. Thanks to 'rhf' for drawing my attention to this issue.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">olipfei 2008-07-03 21:04</div>
        <div class="panel-body">
          <p>Cleaned up the patch a little bit and incorporated a further suggestion due to 'rhf'.  I would not mind if it were accepted now ;-)</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">rhf 2008-07-06 16:48</div>
        <div class="panel-body">
          <p>Excellent!  I really like this feature and hope that the patch will be incorporated into CodeBlocks. Good work, Olipfei.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">rhf 2008-08-01 21:51</div>
        <div class="panel-body">
          <p>I have been using this excellent patch for nearly a month (on Windows XP) with absolutely no problems. Today SVN Rev 5174 caused a conflict with the patched file 'trunk/src/sdk/projectmanager.cpp'. I really don't know how to fix the conflict so I have reverted to an earlier Rev. However, it would really be nice if this feature could be incorporated into the main program. If I could help a developer in any way, perhaps with testing, I would be happy to do so.</p>
          <p>Thanks.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">olipfei 2008-09-01 20:47</div>
        <div class="panel-body">
          <p>Uploaded updated patch to match revision 5200, due to rhf's request.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">rhf 2008-09-02 01:05</div>
        <div class="panel-body">
          <p>Thanks very much for the updated patch.  It would be great if it were incorporated into the trunk.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">mortenmacfly 2008-10-25 18:05</div>
        <div class="panel-body">
          <p>I have applied the patch partially.</p>
          <p>For the rest (to add the menu entry):</p>
          <p>I am not satisfied with it. The menu entry is just below "Switch header / source" which is *really* often used. I for myself chose "Remove file from project" a lot by mistake because it's on the "Switch..." things original position. this is very annoying as you really have to add the file again. A message box warning about the file to be removed would be really welcome here. In addition: Probably you can make this menu entry to appear on the very bottom of the menu?</p>
          <p>Anyways: It would be nice if you could update the patch so it matches trunk again.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">olipfei 2008-10-27 20:07</div>
        <div class="panel-body">
          <p>Thanks for pointing me to this, I also had some concerns about the 'ideal' place for the menu entry. Usually I'm a keen keyboard user, I press F11 to switch between source and header, and so I didn't observe that the old position caused confusion. But are you sure you want to have another dialog popping up? The 'Remove file' procedure in the project management pane which was already there before my patch doesn't warn before it acts either. And you have to admit that some UI parts of CB could bear some streamlining...</p>
          <p>I placed my entries at the bottom of the menu now (after the 'Properties...' menu entry, internally) and synced the code with rev 5294. Note that my patch also includes two minor fixes for problems (possibly crashes) of CB in cbEditor::SetProjectFile  and cbEditor::SaveAs (see conversation below).</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">olipfei 2008-10-27 20:12</div>
        <div class="panel-body">
          <p>Oops, forgot checkbox to upload revised patch.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">rhf 2008-10-28 01:05</div>
        <div class="panel-body">
          <p>Guys, I applied olipfei's updated patch of Oct 27 to rev 5294.</p>
          <p>It seems to work fine for me on Windows XP.  Also, I like the menu entry at the bottom; it makes it easier to find. Thanks.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">mortenmacfly 2009-01-16 09:54</div>
        <div class="panel-body">
          <p>Just for the record: I am still on this... it's not forgotten. :-)</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">rhf 2009-01-18 18:54</div>
        <div class="panel-body">
          <p>Thanks, mortenmacfly.  If I can help in any way, perhaps with testing, I would be glad to do so.</p>
        </div>
      </div>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script>
      $(document).ready(function() {
        $("body").tooltip({ selector: '[data-toggle=tooltip]' });
      });
    </script>
  </body>
</html>