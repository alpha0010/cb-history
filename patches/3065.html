<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Patch 3065 - Code::Blocks History</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">

    <link rel="stylesheet" href="../pygments.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="navbar navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://www.codeblocks.org/">Code::Blocks</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../index.html">Home</a></li>
            <li><a href="../bugs.html">Bugs</a></li>
            <li><a href="../features.html">Features</a></li>
            <li class="active"><a href="../patches.html">Patches</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container" role="main">
      <div class="row">
        <div class="col-sm-8">
          <h3>Patch #3065 <small>2010-09-14 20:05:03</small></h3>
          <h4>tpetrov</h4>
          Context menu item to show file in project tree
          <dl class="dl-horizontal">
            <dt>Download</dt>
            <dd><a href="3065-Context_menu_i.patch">3065-Context_menu_i.patch</a></dd>
          </dl>
        </div>
        <div class="col-sm-4">
          <dl class="dl-horizontal">
            <dt>Category</dt><dd>Application::FeatureAdd</dd>
            <dt>Status</dt><dd>Accepted</dd>
            <dt>Close date</dt><dd>2011-02-13 11:28:14</dd>
            <dt>Assigned to</dt><dd>mortenmacfly</dd>
          </dl>
        </div>
      </div>
      <div class="highlight"><pre class="pre-scrollable"><span class="gh">Index: src/sdk/cbeditor.cpp</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/sdk/cbeditor.cpp    (revision 6574)</span>
<span class="gi">+++ src/sdk/cbeditor.cpp    (working copy)</span>
<span class="gu">@@ -656,6 +656,7 @@</span>
 const int idProperties = wxNewId();
 const int idAddFileToProject = wxNewId();
 const int idRemoveFileFromProject = wxNewId();
<span class="gi">+const int idShowFileInProject = wxNewId();</span>
 
 const int idBookmarkAdd = wxNewId();
 const int idBookmarkRemove = wxNewId();
<span class="gu">@@ -692,6 +693,7 @@</span>
     EVT_MENU(idProperties, cbEditor::OnContextMenuEntry)
     EVT_MENU(idAddFileToProject, cbEditor::OnContextMenuEntry)
     EVT_MENU(idRemoveFileFromProject, cbEditor::OnContextMenuEntry)
<span class="gi">+    EVT_MENU(idShowFileInProject, cbEditor::OnContextMenuEntry)</span>
     EVT_MENU(idBookmarkAdd, cbEditor::OnContextMenuEntry)
     EVT_MENU(idBookmarkRemove, cbEditor::OnContextMenuEntry)
     EVT_MENU(idBreakpointAdd, cbEditor::OnContextMenuEntry)
<span class="gu">@@ -2692,6 +2694,7 @@</span>
             {
                 popup-&gt;Append(idRemoveFileFromProject, _(&quot;Remove file from project&quot;));
                 popup-&gt;Enable(idRemoveFileFromProject, isAddRemoveEnabled);
<span class="gi">+                popup-&gt;Append(idShowFileInProject, _(&quot;Show file in the project tree&quot;));</span>
             }
             else
             {
<span class="gu">@@ -2951,6 +2954,19 @@</span>
             Manager::Get()-&gt;GetProjectManager()-&gt;RebuildTree();
         }
     }
<span class="gi">+    else if (id == idShowFileInProject)</span>
<span class="gi">+    {</span>
<span class="gi">+        wxTreeCtrl* tree = Manager::Get()-&gt;GetProjectManager()-&gt;GetTree();</span>
<span class="gi">+        if (m_pProjectFile &amp;&amp; tree)</span>
<span class="gi">+        {</span>
<span class="gi">+            const wxTreeItemId &amp;itemId = m_pProjectFile-&gt;GetTreeItemId();</span>
<span class="gi">+            if (itemId.IsOk())</span>
<span class="gi">+            {</span>
<span class="gi">+                tree-&gt;EnsureVisible(itemId);</span>
<span class="gi">+                tree-&gt;SelectItem(itemId, true);</span>
<span class="gi">+            }</span>
<span class="gi">+        }</span>
<span class="gi">+    }</span>
     else if (id == idBreakpointAdd)
         AddBreakpoint(m_pData-&gt;m_LastMarginMenuLine);
     else if (id == idBreakpointEdit)
<span class="gh">Index: src/sdk/editormanager.cpp</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/sdk/editormanager.cpp    (revision 6574)</span>
<span class="gi">+++ src/sdk/editormanager.cpp    (working copy)</span>
<span class="gu">@@ -151,6 +151,7 @@</span>
 static const int idNBProperties = wxNewId();
 static const int idNBAddFileToProject = wxNewId();
 static const int idNBRemoveFileFromProject = wxNewId();
<span class="gi">+static const int idNBShowFileInTree = wxNewId();</span>
 
 /** *******************************************************
   * struct EditorManagerInternalData                      *
<span class="gu">@@ -196,6 +197,7 @@</span>
     EVT_MENU(idNBProperties, EditorManager::OnProperties)
     EVT_MENU(idNBAddFileToProject, EditorManager::OnAddFileToProject)
     EVT_MENU(idNBRemoveFileFromProject, EditorManager::OnRemoveFileFromProject)
<span class="gi">+    EVT_MENU(idNBShowFileInTree, EditorManager::OnShowFileInTree)</span>
     EVT_MENU(idEditorManagerCheckFiles, EditorManager::OnCheckForModifiedFiles)
 END_EVENT_TABLE()
 
<span class="gu">@@ -2830,8 +2832,12 @@</span>
         {
             pop-&gt;AppendSeparator();
 
<span class="gd">-            if (ed-&gt;GetProjectFile())</span>
<span class="gi">+            ProjectFile *projectFile = ed-&gt;GetProjectFile();</span>
<span class="gi">+            if (projectFile)</span>
<span class="gi">+            {</span>
                 pop-&gt;Append(idNBRemoveFileFromProject, _(&quot;Remove file from project&quot;));
<span class="gi">+                pop-&gt;Append(idNBShowFileInTree, _(&quot;Show file in the project tree&quot;));</span>
<span class="gi">+            }</span>
             else
                 pop-&gt;Append(idNBAddFileToProject, _(&quot;Add file to active project&quot;));
         }
<span class="gu">@@ -2941,6 +2947,21 @@</span>
     }
 }
 
<span class="gi">+void EditorManager::OnShowFileInTree(wxCommandEvent&amp; event)</span>
<span class="gi">+{</span>
<span class="gi">+    ProjectFile* pf = GetBuiltinActiveEditor()-&gt;GetProjectFile();</span>
<span class="gi">+    wxTreeCtrl* tree = Manager::Get()-&gt;GetProjectManager()-&gt;GetTree();</span>
<span class="gi">+    if (pf &amp;&amp; tree) // should be in any case, otherwise something went wrong between popup menu creation and here</span>
<span class="gi">+    {</span>
<span class="gi">+        const wxTreeItemId &amp;itemId = pf-&gt;GetTreeItemId();</span>
<span class="gi">+        if (itemId.IsOk())</span>
<span class="gi">+        {</span>
<span class="gi">+            tree-&gt;EnsureVisible(itemId);</span>
<span class="gi">+            tree-&gt;SelectItem(itemId, true);</span>
<span class="gi">+        }</span>
<span class="gi">+    }</span>
<span class="gi">+}</span>
<span class="gi">+</span>
 void EditorManager::OnAppDoneStartup(wxCommandEvent&amp; event)
 {
     event.Skip(); // allow others to process it too
<span class="gh">Index: src/include/projectfile.h</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/include/projectfile.h    (revision 6574)</span>
<span class="gi">+++ src/include/projectfile.h    (working copy)</span>
<span class="gu">@@ -175,6 +175,9 @@</span>
 
         /** Auto-generated files when compiling this file */
         ProjectFilesVector generatedFiles;
<span class="gi">+</span>
<span class="gi">+        /** Returns the wxTreeItemId for the file */</span>
<span class="gi">+        const wxTreeItemId&amp; GetTreeItemId() const { return m_TreeItemId; }</span>
     protected:
         friend class cbProject;
 
<span class="gh">Index: src/include/editormanager.h</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/include/editormanager.h    (revision 6574)</span>
<span class="gi">+++ src/include/editormanager.h    (working copy)</span>
<span class="gu">@@ -159,6 +159,7 @@</span>
         void OnProperties(wxCommandEvent&amp; event);
         void OnAddFileToProject(wxCommandEvent&amp; event);
         void OnRemoveFileFromProject(wxCommandEvent&amp; event);
<span class="gi">+        void OnShowFileInTree(wxCommandEvent&amp; event);</span>
         void OnAppDoneStartup(wxCommandEvent&amp; event);
         void OnAppStartShutdown(wxCommandEvent&amp; event);
         void OnUpdateUI(wxUpdateUIEvent&amp; event);
</pre></div>

      <h4 class="page-header">History</h4>
      
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
  </body>
</html>