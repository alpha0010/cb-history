<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Patch 3308 - Code::Blocks History</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">

    <link rel="stylesheet" href="../pygments.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="navbar navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://www.codeblocks.org/">Code::Blocks</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../index.html">Home</a></li>
            <li><a href="../bugs.html">Bugs</a></li>
            <li><a href="../features.html">Features</a></li>
            <li class="active"><a href="../patches.html">Patches</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container" role="main">
      <div class="row">
        <div class="col-sm-8">
          <h3>Patch #3308 <small>2012-07-15 05:02:11</small></h3>
          <h4>alpha0010</h4>
          (Fix) highlight wxSmith generated code
          <dl class="dl-horizontal">
            <dt>Download</dt>
            <dd><a href="3308-Fix_highlight.patch">3308-Fix_highlight.patch</a> (8.7 KB)</dd>
          </dl>
        </div>
        <div class="col-sm-4">
          <dl class="dl-horizontal">
            <dt>Category</dt><dd>Lexer</dd>
            <dt>Status</dt><dd>Accepted</dd>
            <dt>Close date</dt><dd>2012-07-18 20:48:58 <a href="http://cb.biplab.in/websvn/log.php?sr=8142"><span class="glyphicon glyphicon-link"></span></a></dd>
            <dt>Assigned to</dt><dd>mortenmacfly</dd>
          </dl>
        </div>
      </div>
      <div class="highlight"><pre class="pre-scrollable"><span class="gh">Index: src/sdk/editorconfigurationdlg.cpp</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/sdk/editorconfigurationdlg.cpp    (revision 8133)</span>
<span class="gi">+++ src/sdk/editorconfigurationdlg.cpp    (working copy)</span>
<span class="gu">@@ -543,6 +543,7 @@</span>
     if (cookie == wxNOT_FOUND)
         cookie = 0;
     cmbThemes-&gt;SetSelection(cookie);
<span class="gi">+    XRCCTRL(*this, &quot;chkColoursWxSmith&quot;, wxCheckBox)-&gt;SetValue(cfg-&gt;ReadBool(_T(&quot;/colour_sets/highlight_wxsmith&quot;), true));</span>
     ChangeTheme();
 }
 
<span class="gu">@@ -612,6 +613,7 @@</span>
     {
         wxString sel = cmbLangs-&gt;GetStringSelection();
         m_Lang = m_Theme-&gt;GetHighlightLanguage(sel);
<span class="gi">+        XRCCTRL(*this, &quot;chkColoursWxSmith&quot;, wxCheckBox)-&gt;Show(sel == wxT(&quot;C/C++&quot;));</span>
     }
 
     CreateColoursSample();
<span class="gu">@@ -727,6 +729,7 @@</span>
     {
         wxString sel = XRCCTRL(*this, &quot;cmbLangs&quot;, wxComboBox)-&gt;GetStringSelection();
         m_Lang = m_Theme-&gt;GetHighlightLanguage(sel);
<span class="gi">+        XRCCTRL(*this, &quot;chkColoursWxSmith&quot;, wxCheckBox)-&gt;Show(sel == wxT(&quot;C/C++&quot;));</span>
     }
     FillColourComponents();
     CreateColoursSample();
<span class="gu">@@ -930,6 +933,7 @@</span>
             cfg-&gt;Write(_T(&quot;/colour_sets/active_colour_set&quot;), m_Theme-&gt;GetName());
         }
         cfg-&gt;Write(_T(&quot;/colour_sets/active_lang&quot;), XRCCTRL(*this, &quot;cmbLangs&quot;, wxComboBox)-&gt;GetStringSelection());
<span class="gi">+        cfg-&gt;Write(_T(&quot;/colour_sets/highlight_wxsmith&quot;), XRCCTRL(*this, &quot;chkColoursWxSmith&quot;, wxCheckBox)-&gt;GetValue());</span>
 
         // encoding
         wxComboBox* cmbEnc = XRCCTRL(*this, &quot;cmbEncoding&quot;, wxComboBox);
<span class="gh">Index: src/sdk/cbeditor.cpp</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/sdk/cbeditor.cpp    (revision 8133)</span>
<span class="gi">+++ src/sdk/cbeditor.cpp    (working copy)</span>
<span class="gu">@@ -1604,6 +1604,7 @@</span>
         control-&gt;SetProperty(_T(&quot;fold&quot;), _T(&quot;0&quot;));
         control-&gt;SetMarginWidth(C_FOLDING_MARGIN, 0);
     }
<span class="gi">+    control-&gt;SetProperty(_T(&quot;highlight.wxsmith&quot;), mgr-&gt;ReadBool(_T(&quot;/colour_sets/highlight_wxsmith&quot;), true) ? _T(&quot;1&quot;) : _T(&quot;0&quot;));</span>
 
     // line numbering
     control-&gt;SetMarginType(C_LINE_MARGIN, wxSCI_MARGIN_NUMBER);
<span class="gh">Index: src/sdk/wxscintilla/include/wx/wxscintilla.h</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/sdk/wxscintilla/include/wx/wxscintilla.h    (revision 8133)</span>
<span class="gi">+++ src/sdk/wxscintilla/include/wx/wxscintilla.h    (working copy)</span>
<span class="gu">@@ -577,7 +577,7 @@</span>
 /* C::B begin */
 // Keep in sync with SciLexer.h      -&gt; SCE_C_WXSMITH
 // Keep in sync with Scintilla.iface -&gt; SCE_C_WXSMITH
<span class="gd">-#define wxSCI_C_WXSMITH 99</span>
<span class="gi">+#define wxSCI_C_WXSMITH 50</span>
 /* C::B end */
 
 // Lexical states for SCLEX_D
<span class="gh">Index: src/sdk/wxscintilla/src/scintilla/include/Scintilla.iface</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/sdk/wxscintilla/src/scintilla/include/Scintilla.iface    (revision 8133)</span>
<span class="gi">+++ src/sdk/wxscintilla/src/scintilla/include/Scintilla.iface    (working copy)</span>
<span class="gu">@@ -273,9 +273,9 @@</span>
 
 enu MarkerOutline=SC_MARKNUM_
 # CHANGEBAR begin #
<span class="gd">-# Markers used for outlining and changed column. </span>
<span class="gd">-val SC_MARKNUM_CHANGEUNSAVED=23 </span>
<span class="gd">-val SC_MARKNUM_CHANGESAVED=24 </span>
<span class="gi">+# Markers used for outlining and changed column.</span>
<span class="gi">+val SC_MARKNUM_CHANGEUNSAVED=23</span>
<span class="gi">+val SC_MARKNUM_CHANGESAVED=24</span>
 # CHANGEBAR end #
 val SC_MARKNUM_FOLDEREND=25
 val SC_MARKNUM_FOLDEROPENMID=26
<span class="gu">@@ -2565,7 +2565,7 @@</span>
 # WXSMITH begin #
 # Keep in sync with wxscinilla.h -&gt; wxSCI_C_WXSMITH
 # Keep in sync with SciLexer.h   -&gt; SCE_C_WXSMITH
<span class="gd">-val SCE_C_WXSMITH=99</span>
<span class="gi">+val SCE_C_WXSMITH=50</span>
 # WXSMITH end #
 # Lexical states for SCLEX_D
 lex D=SCLEX_D SCE_D_
<span class="gh">Index: src/sdk/wxscintilla/src/scintilla/include/SciLexer.h</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/sdk/wxscintilla/src/scintilla/include/SciLexer.h    (revision 8133)</span>
<span class="gi">+++ src/sdk/wxscintilla/src/scintilla/include/SciLexer.h    (working copy)</span>
<span class="gu">@@ -164,7 +164,7 @@</span>
 /* C::B begin */
 // Keep in sync with wxscinilla.h    -&gt; wxSCI_C_WXSMITH
 // Keep in sync with Scintilla.iface -&gt; SCE_C_WXSMITH
<span class="gd">-#define SCE_C_WXSMITH 99</span>
<span class="gi">+#define SCE_C_WXSMITH 50</span>
 /* C::B end */
 #define SCE_D_DEFAULT 0
 #define SCE_D_COMMENT 1
<span class="gh">Index: src/sdk/wxscintilla/src/scintilla/lexers/LexCPP.cxx</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/sdk/wxscintilla/src/scintilla/lexers/LexCPP.cxx    (revision 8133)</span>
<span class="gi">+++ src/sdk/wxscintilla/src/scintilla/lexers/LexCPP.cxx    (working copy)</span>
<span class="gu">@@ -218,7 +218,7 @@</span>
     bool foldCompact;
     bool foldAtElse;
 /* C::B begin */
<span class="gd">-    bool foldWxSmith;</span>
<span class="gi">+    bool highlightWxSmith;</span>
 /* C::B end */
     OptionsCPP() {
         stylingWithinPreprocessor = false;
<span class="gu">@@ -239,7 +239,7 @@</span>
         foldCompact = false;
         foldAtElse = false;
 /* C::B begin */
<span class="gd">-        foldWxSmith = false;</span>
<span class="gi">+        highlightWxSmith = true;</span>
 /* C::B end */
     }
 };
<span class="gu">@@ -306,6 +306,10 @@</span>
 
         DefineProperty(&quot;fold.compact&quot;, &amp;OptionsCPP::foldCompact);
 
<span class="gi">+/* C::B begin */</span>
<span class="gi">+        DefineProperty(&quot;highlight.wxsmith&quot;, &amp;OptionsCPP::highlightWxSmith);</span>
<span class="gi">+/* C::B end */</span>
<span class="gi">+</span>
         DefineProperty(&quot;fold.at.else&quot;, &amp;OptionsCPP::foldAtElse,
             &quot;T
<em><strong>file truncated...</strong></em>
</pre></div>

      <h4 class="page-header">History</h4>
      <div class="panel panel-default">
        <div class="panel-heading">alpha0010 2012-07-15 05:05:01</div>
        <div class="panel-body">
          <p>I could not help but notice someone had started extending the C++ lexer to support wxSmith code; this patch completes it.</p>
          <p>It also adds the option to disable highlighting of wxSmith code (reverting to normal C++ syntax).</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">mortenmacfly 2012-07-15 07:03:59</div>
        <div class="panel-body">
          <p>I noticed something: wxSmith should always be index 99, nothing else. The reason is not to conflict with extensions of scintilla itself. Otherwise we have to adopt it everytime when a lexer is added.</p>
          <p>Also, it really is about folding - why is it named "highlightWxSmith" now? Its there to fold wxSmith code, not to highlight it.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">alpha0010 2012-07-15 12:03:21</div>
        <div class="panel-body">
          <p>Due to the enum "activeFlag" in LexCPP.cxx, the index must be &lt; 64 (0x40); I choose 50 arbitrarily as a nice round number.  (Also, scintilla would have to add 27 more items to the C++ lexer before this would conflict.)</p>
          <p>I removed all references to "foldWxSmith" because it never was a working option (nor even accessible/used).  The code that folds wxSmith is actually lines 1033-1038 (1020-1025 before the patch).</p>
          <p>I could write an option to control this.</p>
          <p>I added "highlightWxSmith" so that the user could turn off the identification of wxSmith code, and just see normal C++ highlighting.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">mortenmacfly 2012-07-15 14:46:27</div>
        <div class="panel-body">
          <p>OK understood and agreed - in fact I never noticed that.</p>
          <p>The patch looks fine, however, I don't like the place of the checkbox in the lexers. It applies only to the C/C++ lexer and is visible all the time.</p>
          <p>I think it should go to the editor settings, below the option to interpret #if #else #endif.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">alpha0010 2012-07-15 17:01:10</div>
        <div class="panel-body">
          <p>The editor settings page is already quite large, and I would prefer not increasing its size further.</p>
          <p>This revision shows/hides the checkbox depending on the selected language.  Is that acceptable?</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">mortenmacfly 2012-07-15 18:46:53</div>
        <div class="panel-body">
          <p>&gt; Is that acceptable?</p>
          <p>Actually not, because then we would need to transfer even more settings. I believe it simply doesn't belong there, because people don't expect it there and would not find/use it.</p>
          <p>The best way on the long run would be to re-factor the UI of the editor settings. For now, don't worry about putting this into this UI although its a bit messy...</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">mortenmacfly 2012-07-15 19:35:35</div>
        <div class="panel-body">
          <p>OK, I think I got a solution: In the editor settings we should add another tab like "C/C++ editor options" and in there we can move all settings from the other tabs (including the new wxSmith one) that apply only to C/C++ editors. How does that sound?</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">alpha0010 2012-07-16 02:17:12</div>
        <div class="panel-body">
          <p>I think that is a good option.  Do you want to work on migrating the settings?  If not, I will try to get around to it.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">mortenmacfly 2012-07-16 06:02:01</div>
        <div class="panel-body">
          <p>Yes, I can do it... just for this and the next week my time will definitely be limited due to "real" work. If you come up with something earlier I won't kill you. ;-)</p>
        </div>
      </div>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
  </body>
</html>