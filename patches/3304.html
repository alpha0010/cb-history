<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Patch 3304 - Code::Blocks History</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">

    <link rel="stylesheet" href="../pygments.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="navbar navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://www.codeblocks.org/">Code::Blocks</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../index.html">Home</a></li>
            <li><a href="../bugs.html">Bugs</a></li>
            <li><a href="../features.html">Features</a></li>
            <li class="active"><a href="../patches.html">Patches</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container" role="main">
      <div class="row">
        <div class="col-sm-8">
          <h3>Patch #3304 <small>2012-07-10 01:41:39</small></h3>
          <h4>alpha0010</h4>
          Move line(s) up/down (shortcut)
          <dl class="dl-horizontal">
            <dt>Download</dt>
            <dd><a href="3304-Move_line_s_up.patch">3304-Move_line_s_up.patch</a></dd>
          </dl>
        </div>
        <div class="col-sm-4">
          <dl class="dl-horizontal">
            <dt>Category</dt><dd>Application::FeatureAdd</dd>
            <dt>Status</dt><dd>Accepted</dd>
            <dt>Close date</dt><dd>2012-07-14 07:44:26 <a href="http://cb.biplab.in/websvn/log.php?sr=8114"><span class="glyphicon glyphicon-link"></span></a></dd>
            <dt>Assigned to</dt><dd>mortenmacfly</dd>
          </dl>
        </div>
      </div>
      <div class="highlight"><pre class="pre-scrollable"><span class="gh">Index: src/src/main.h</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/src/main.h    (revision 8097)</span>
<span class="gi">+++ src/src/main.h    (working copy)</span>
<span class="gu">@@ -165,6 +165,7 @@</span>
         void OnEditLineTranspose(wxCommandEvent&amp; event);
         void OnEditLineCopy(wxCommandEvent&amp; event);
         void OnEditLinePaste(wxCommandEvent&amp; event);
<span class="gi">+        void OnEditLineMove(wxCommandEvent&amp; event);</span>
         void OnEditUpperCase(wxCommandEvent&amp; event);
         void OnEditLowerCase(wxCommandEvent&amp; event);
         void OnEditInsertNewLine(wxCommandEvent&amp; event);
<span class="gh">Index: src/src/resources/main_menu.xrc</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/src/resources/main_menu.xrc    (revision 8097)</span>
<span class="gi">+++ src/src/resources/main_menu.xrc    (working copy)</span>
<span class="gu">@@ -418,6 +418,16 @@</span>
             &lt;label&gt;Paste&lt;/label&gt;
             &lt;help&gt;Paste before current line&lt;/help&gt;
           &lt;/object&gt;
<span class="gi">+          &lt;object class=&quot;wxMenuItem&quot; name=&quot;idEditLineUp&quot;&gt;</span>
<span class="gi">+            &lt;label&gt;Move up&lt;/label&gt;</span>
<span class="gi">+            &lt;accel&gt;Alt-UP&lt;/accel&gt;</span>
<span class="gi">+            &lt;help&gt;Transpose current line(s) up&lt;/help&gt;</span>
<span class="gi">+          &lt;/object&gt;</span>
<span class="gi">+          &lt;object class=&quot;wxMenuItem&quot; name=&quot;idEditLineDown&quot;&gt;</span>
<span class="gi">+            &lt;label&gt;Move down&lt;/label&gt;</span>
<span class="gi">+            &lt;accel&gt;Alt-DOWN&lt;/accel&gt;</span>
<span class="gi">+            &lt;help&gt;Transpose current line(s) down&lt;/help&gt;</span>
<span class="gi">+          &lt;/object&gt;</span>
         &lt;/object&gt;
         &lt;object class=&quot;wxMenu&quot; name=&quot;idEditSpecialCommandsCase&quot;&gt;
           &lt;label&gt;Case&lt;/label&gt;
<span class="gh">Index: src/src/main.cpp</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/src/main.cpp    (revision 8097)</span>
<span class="gi">+++ src/src/main.cpp    (working copy)</span>
<span class="gu">@@ -226,6 +226,8 @@</span>
 int idEditLineTranspose           = XRCID(&quot;idEditLineTranspose&quot;);
 int idEditLineCopy                = XRCID(&quot;idEditLineCopy&quot;);
 int idEditLinePaste               = XRCID(&quot;idEditLinePaste&quot;);
<span class="gi">+int idEditLineUp                  = XRCID(&quot;idEditLineUp&quot;);</span>
<span class="gi">+int idEditLineDown                = XRCID(&quot;idEditLineDown&quot;);</span>
 int idEditSpecialCommandsCase     = XRCID(&quot;idEditSpecialCommandsCase&quot;);
 int idEditUpperCase               = XRCID(&quot;idEditUpperCase&quot;);
 int idEditLowerCase               = XRCID(&quot;idEditLowerCase&quot;);
<span class="gu">@@ -444,6 +446,8 @@</span>
     EVT_MENU(idEditLineTranspose,         MainFrame::OnEditLineTranspose)
     EVT_MENU(idEditLineCopy,              MainFrame::OnEditLineCopy)
     EVT_MENU(idEditLinePaste,             MainFrame::OnEditLinePaste)
<span class="gi">+    EVT_MENU(idEditLineUp,                MainFrame::OnEditLineMove)</span>
<span class="gi">+    EVT_MENU(idEditLineDown,              MainFrame::OnEditLineMove)</span>
     EVT_MENU(idEditUpperCase,             MainFrame::OnEditUpperCase)
     EVT_MENU(idEditLowerCase,             MainFrame::OnEditLowerCase)
     EVT_MENU(idEditInsertNewLine,         MainFrame::OnEditInsertNewLine)
<span class="gu">@@ -3239,6 +3243,47 @@</span>
     }
 }
 
<span class="gi">+void MainFrame::OnEditLineMove(wxCommandEvent&amp; event)</span>
<span class="gi">+{</span>
<span class="gi">+    cbEditor* ed = Manager::Get()-&gt;GetEditorManager()-&gt;GetBuiltinActiveEditor();</span>
<span class="gi">+    if (ed)</span>
<span class="gi">+    {</span>
<span class="gi">+        cbStyledTextCtrl* ctrl = ed-&gt;GetControl();</span>
<span class="gi">+        if (ctrl-&gt;GetSelections() &gt; 1)</span>
<span class="gi">+            return;</span>
<span class="gi">+        int startPos = ctrl-&gt;PositionFromLine(ctrl-&gt;LineFromPosition(ctrl-&gt;GetSelectionStart()));</span>
<span class="gi">+        int endPos = ctrl-&gt;PositionFromLine(ctrl-&gt;LineFromPosition(ctrl-&gt;GetSelectionEnd()) + 1) - 1;</span>
<span class="gi">+        if (event.GetId() == idEditLineUp)</span>
<span class="gi">+        {</span>
<span class="gi">+            if (startPos &lt; 2)</span>
<span class="gi">+                return;</span>
<span class="gi">+            ctrl-&gt;BeginUndoAction();</span>
<span class="gi">+            wxString line = ctrl-&gt;GetTextRange(ctrl-&gt;PositionFromLine(ctrl-&gt;LineFromPosition(startPos) - 1),</span>
<span class="gi">+                                               startPos);</span>
<span class="gi">+            ctrl-&gt;InsertText(endPos + 1, line);</span>
<span class="gi">+            ctrl-&gt;DeleteRange(startPos - line.Length(), line.Length());</span>
<span class="gi">+            startPos -= line.Length();</span>
<span class="gi">+            endPos -= line.Length();</span>
<span class="gi">+            ctrl-&gt;EndUndoAction();</span>
<span class="gi">+        }</span>
<span class="gi">+        else</span>
<span class="gi">+        {</span>
<span class="gi">+            if (ctrl-&gt;LineFromPosition(ctrl-&gt;GetSelectionEnd()) == ctrl-&gt;GetLineCount())</span>
<span class="gi">+                return;</span>
<span class="gi">+            ctrl-&gt;BeginUndoAction();</span>
<span class="gi">+            wxString line = ctrl-&gt;GetTextRange(endPos + 1,</span>
<span class="gi">+                                               ctrl-&gt;PositionFromLine(ctrl-&gt;LineFromPosition(endPos + 1) + 1));</span>
<span class="gi">+            ctrl-&gt;DeleteRange(endPos + 1, line.Length());</span>
<span class="gi">+            ctrl-&gt;InsertText(startPos, line);</span>
<span class="gi">+            startPos += line.Length();</span>
<span class="gi">+            endPos += line.Length();</span>
<span class="gi">+            ctrl-&gt;EndUndoAction();</span>
<span class="gi">+        }</span>
<span class="gi">+        ctrl-&gt;SetSelectionStart(startPos);</span>
<span class="gi">+        ctrl-&gt;SetSelectionEnd(endPos);</span>
<span class="gi">+    }</span>
<span class="gi">+}</span>
<span class="gi">+</span>
 void MainFrame::OnEditUpperCase(wxCommandEvent&amp; /*event*/)
 {
     cbEditor* ed = Manager::Get()-&gt;GetEditorManager()-&gt;GetBuiltinActiveEditor();
</pre></div>

      <h4 class="page-header">History</h4>
      <div class="panel panel-default">
        <div class="panel-heading">mortenmacfly 2012-07-10 05:52:08</div>
        <div class="panel-body">
          <p>Nice one!</p>
          <p>But you have to be careful here:</p>
          <p>- Did you try with rectangle selection mode?</p>
          <p>- Did you try with virtual space mode?</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">mortenmacfly 2012-07-10 06:09:38</div>
        <div class="panel-body">
          <p>...maybe it can be as simple as that you just return, if the selection is rectangular or virtual space is selected (not sure about the second on). In rectangle selection mode you cannot do anything meaningful anyways IMHO...</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">alpha0010 2012-07-11 12:28:33</div>
        <div class="panel-body">
          <p>Virtual space and rectangular select already work (all lines that have selection somewhere on them are treated as selected).</p>
          <p>This revision fixes the multiple selection case (by avoiding it with a return).</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">mortenmacfly 2012-07-11 12:38:32</div>
        <div class="panel-body">
          <p>I know it was "somewhat" working with rectangular. My point is, does the user expect the whole lines move when (s)he has selected a rectangular area? I believe not. I would expect only the rectangular area moves which is not the case... what about you?</p>
          <p>Will try the update though...</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">alpha0010 2012-07-13 00:28:13</div>
        <div class="panel-body">
          <p>This is the behavior I would expect (it is under the 'Line' menu, and therefore effects lines as whole units), however that is only me.  I am not certain what other users would think of this.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">mortenmacfly 2012-07-13 08:18:34</div>
        <div class="panel-body">
          <p>Hmmm I see. I wasn't even aware its under the "Line" menu, as I always use short-cuts a lot. I also see that is might be feasible (because easier) to just roughly select the lines for the movement, so not exactly the whole line. Is it worth an option? I think not... I would wonder what behaviour the majority of users expects and go for that... when committing, I'll place a ToDo in the code accordingly.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">alpha0010 2012-07-13 20:44:37</div>
        <div class="panel-body">
          <p>I am not sure if what you said is a feature request or a comment, but current behavior expands rough selections to the nearest whole line.</p>
        </div>
      </div>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
  </body>
</html>