<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Patch 3117 - Code::Blocks History</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">

    <link rel="stylesheet" href="../pygments.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="navbar navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://www.codeblocks.org/">Code::Blocks</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../index.html">Home</a></li>
            <li><a href="../bugs.html">Bugs</a></li>
            <li><a href="../features.html">Features</a></li>
            <li class="active"><a href="../patches.html">Patches</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container" role="main">
      <div class="row">
        <div class="col-sm-8">
          <h3>Patch #3117 <small>2011-01-15 09:16:14</small></h3>
          <h4>etheranger</h4>
          Correctly set CDB's working directory
          <dl class="dl-horizontal">
            <dt>Download</dt>
            <dd><a href="3117-Correctly_set.patch">3117-Correctly_set.patch</a> (1.9 KB)</dd>
          </dl>
        </div>
        <div class="col-sm-4">
          <dl class="dl-horizontal">
            <dt>Category</dt><dd>Application::Bugfix</dd>
            <dt>Status</dt><dd>Out of date</dd>
            <dt>Close date</dt><dd>2011-02-03 20:02:23</dd>
            <dt>Assigned to</dt><dd>mortenmacfly</dd>
          </dl>
        </div>
      </div>
      <div class="highlight"><pre class="pre-scrollable"><span class="gh">Index: src/plugins/debuggergdb/cdb_driver.cpp</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/plugins/debuggergdb/cdb_driver.cpp    (revision 6920)</span>
<span class="gi">+++ src/plugins/debuggergdb/cdb_driver.cpp    (working copy)</span>
<span class="gu">@@ -24,7 +24,8 @@</span>
 static wxRegEx reFile(_T(&quot;[ \t]([A-z]+.*)[ \t]+\\[([A-z]:)(.*) @ ([0-9]+)\\]&quot;));
 
 CDB_driver::CDB_driver(DebuggerGDB* plugin)
<span class="gd">-    : DebuggerDriver(plugin)</span>
<span class="gi">+    : DebuggerDriver(plugin),</span>
<span class="gi">+    m_Debuggee(wxEmptyString)</span>
 {
     //ctor
 }
<span class="gu">@@ -62,6 +63,10 @@</span>
     // finally, add the program to debug
     cmd &lt;&lt; _T(&#39; &#39;) &lt;&lt; debuggee;
 
<span class="gi">+    // Because of the lack of ChDir functionality for a process which has already been launched,</span>
<span class="gi">+    // do a dodgy workaround by starting with a dummy version of the process, then starting in the right folder later.</span>
<span class="gi">+    m_Debuggee.assign(debuggee);</span>
<span class="gi">+</span>
     if (!m_WorkingDir.IsEmpty())
         wxSetWorkingDirectory(m_WorkingDir);
 
<span class="gu">@@ -104,7 +109,19 @@</span>
 
 void CDB_driver::Prepare(ProjectBuildTarget* /*target*/, bool /*isConsole*/)
 {
<span class="gd">-    // default initialization</span>
<span class="gi">+    if (!m_Debuggee.IsEmpty())</span>
<span class="gi">+    {</span>
<span class="gi">+        // Workaround for setting the correct working dir:</span>
<span class="gi">+        wxString cmd = _T(&quot;.kill; .createdir &quot;);</span>
<span class="gi">+        cmd &lt;&lt; m_WorkingDir;</span>
<span class="gi">+        QueueCommand(new DebuggerCmd(this,cmd)); // Kill the process and CD to the right place</span>
<span class="gi">+</span>
<span class="gi">+        cmd = _T(&quot;.create &quot;);</span>
<span class="gi">+        cmd &lt;&lt; m_Debuggee &lt;&lt; _T(&quot;; g&quot;);</span>
<span class="gi">+        QueueCommand(new DebuggerCmd(this,cmd)); // Restart the process in the correct directory</span>
<span class="gi">+</span>
<span class="gi">+        m_Debuggee.Clear();</span>
<span class="gi">+    }</span>
 }
 
 void CDB_driver::Start(bool /*breakOnEntry*/)
<span class="gh">Index: src/plugins/debuggergdb/cdb_driver.h</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/plugins/debuggergdb/cdb_driver.h    (revision 6920)</span>
<span class="gi">+++ src/plugins/debuggergdb/cdb_driver.h    (working copy)</span>
<span class="gu">@@ -49,6 +49,7 @@</span>
         virtual void ParseOutput(const wxString&amp; output);
     protected:
     private:
<span class="gi">+        wxString m_Debuggee;</span>
 };
 
 #endif // CDB_DRIVER_H
</pre></div>

      <h4 class="page-header">History</h4>
      <div class="panel panel-default">
        <div class="panel-heading">etheranger 2011-01-15 09:18:54</div>
        <div class="panel-body">
          <p>Technically a problem with the debugger plugin launching ANY debugger from the project dir, rather than specified working dir, however GDB's behaviour happens to workaround this by resetting it after launch in GDB_driver::Prepare().</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">etheranger 2011-01-15 14:38:41</div>
        <div class="panel-body">
          <p>REWRITTEN:</p>
          <p>Disregard the previous comment, the debugger needs to run from the current directory or else relative source/symbol paths stop working.</p>
          <p>This more comes down to the complete lack of either starting CDB without a child process or changing the first child's working directory.</p>
          <p>This patch creates a workaround by killing the first child before execution begins, and respawning the process in the right place. Not ideal, but better than not being able to debug it at all.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">etheranger 2011-01-21 13:04:37</div>
        <div class="panel-body">
          <p>Aaand hopefully superseded by #3118, which has a bunch of other fixes, and a more managable version of this one.</p>
          <p>If you'd like your app to run in the right directory /and/ work with breakpoints, asserts and the like, please use that one instead.</p>
        </div>
      </div>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
  </body>
</html>