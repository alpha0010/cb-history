<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Patch 3121 - Code::Blocks History</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">

    <link rel="stylesheet" href="../pygments.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="navbar navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://www.codeblocks.org/">Code::Blocks</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../index.html">Home</a></li>
            <li><a href="../bugs.html">Bugs</a></li>
            <li><a href="../features.html">Features</a></li>
            <li class="active"><a href="../patches.html">Patches</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container" role="main">
      <div class="row">
        <div class="col-sm-8">
          <h3>Patch #3121 <small>2011-01-19 15:04:58</small></h3>
          <h4>marcus_b</h4>
          Including search directories to find relative source files
          <dl class="dl-horizontal">
            <dt>Download</dt>
            <dd><a href="3121-Including_sear.patch">3121-Including_sear.patch</a> (1.2 KB)</dd>
          </dl>
        </div>
        <div class="col-sm-4">
          <dl class="dl-horizontal">
            <dt>Category</dt><dd>Plugin::Bugfix</dd>
            <dt>Status</dt><dd>Open</dd>
            <dt>Close date</dt><dd>&nbsp;</dd>
            <dt>Assigned to</dt><dd>tpetrov</dd>
          </dl>
        </div>
      </div>
      <div class="highlight"><pre class="pre-scrollable"><span class="gd">--- src/plugins/debuggergdb/debuggergdb.cpp.original    2011-01-19 14:53:56.877095951 +0100</span>
<span class="gi">+++ src/plugins/debuggergdb/debuggergdb.cpp    2011-01-19 15:37:55.227135231 +0100</span>
<span class="gu">@@ -2189,8 +2189,25 @@</span>
     cbProject* project = Manager::Get()-&gt;GetProjectManager()-&gt;GetActiveProject();
     ProjectFile* f = project ? project-&gt;GetFileByFilename(filename, false, true) : 0;
     wxFileName fname(filename);
<span class="gd">-    if (project &amp;&amp; fname.IsRelative())</span>
<span class="gd">-        fname.MakeAbsolute(project-&gt;GetBasePath());</span>
<span class="gi">+    if (project &amp;&amp; fname.IsRelative()) </span>
<span class="gi">+    {</span>
<span class="gi">+        wxArrayString&amp; pdirs = GetSearchDirs(project);</span>
<span class="gi">+        wxFileName tmp = fname;        </span>
<span class="gi">+        for (size_t i = 0; i &lt; pdirs.GetCount(); ++i) </span>
<span class="gi">+        {</span>
<span class="gi">+            tmp = fname;</span>
<span class="gi">+            tmp.MakeAbsolute(pdirs[i]);</span>
<span class="gi">+            if (tmp.FileExists()) </span>
<span class="gi">+            {</span>
<span class="gi">+                fname = tmp;</span>
<span class="gi">+                break;</span>
<span class="gi">+            }</span>
<span class="gi">+        }</span>
<span class="gi">+        if (fname.IsRelative()) </span>
<span class="gi">+        {</span>
<span class="gi">+            fname.MakeAbsolute(project-&gt;GetBasePath());</span>
<span class="gi">+        }</span>
<span class="gi">+    }</span>
     // gdb can&#39;t work with spaces in filenames, so we have passed it the shorthand form (C:\MYDOCU~1 etc)
     // revert this change now so the file can be located and opened...
     // we do this by calling GetLongPath()
</pre></div>

      <h4 class="page-header">History</h4>
      <div class="panel panel-default">
        <div class="panel-heading">tpetrov 2011-03-17 21:15:36</div>
        <div class="panel-body">
          <p>Is this patch against trunk or against debugger's branch?</p>
          <p>If it is against trunk, can you provide a patch against debugger's branch?</p>
          <p>Also a test case could be helpful...</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">marcus_b 2011-03-30 21:22:35</div>
        <div class="panel-body">
          <p>My patch supported that clicking on entries in the callstack brings showed the corresponding source file in the editor. This did not work with files from outside the current codeblocks project. Before my changes it was assumed that the relative filenames are inside the current project, which is not always correct because the gdb displays also filenames that are relative to the gdb search directories (e.g. of a dynamically linked thirdparty library).</p>
          <p>The patch is against the sources from the downloadable codeblocks-10.05-src.tar.bz2 archive (2010-06-08), so I assume it is the tags/10.05 branch.</p>
          <p>I had a look at the sources in branches/wxpropgrid_debugger, which I think is the debugger's branch. The DebuggerGDB class was refactored since the release, and the function in which I made the changes was moved to the cbDebuggerPlugin class: DebuggerGBD::SyncEditor() -&gt; cpDebuggerPlugin::SyncEditor().</p>
          <p>Unfortunately cbDebuggerPlugin does not provide the GetSearchDirs() function, so my original patch cannot be applied anymore. Some further refactoring would be required (either pass the search directories as an argument to cpDebuggerPlugin::SyncEditor(), or move the search directories completely to cpDebuggerPlugin).</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">tpetrov 2011-04-02 18:57:21</div>
        <div class="panel-body">
          <p>Can you proved a simple project, which demonstrates the bug?</p>
          <p>If you do, so I can refactor your patch for the debuggers branch.</p>
        </div>
      </div>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
  </body>
</html>