<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Patch 954 - Code::Blocks History</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">

    <link rel="stylesheet" href="../pygments.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="navbar navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://www.codeblocks.org/">Code::Blocks</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../index.html">Home</a></li>
            <li><a href="../bugs.html">Bugs</a></li>
            <li><a href="../features.html">Features</a></li>
            <li class="active"><a href="../patches.html">Patches</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container" role="main">
      <div class="row">
        <div class="col-sm-8">
          <h3>Patch #954 <small>2006-03-25 20:07</small></h3>
          <h4>yop</h4>
          Changed the check for custom makefiles in compiler plugin
          <dl class="dl-horizontal">
            <dt>Download</dt>
            <dd><a href="954-Changed_the_che.patch">954-Changed_the_che.patch</a> (3.3 KB)</dd>
          </dl>
        </div>
        <div class="col-sm-4">
          <dl class="dl-horizontal">
            <dt>Category</dt><dd>Plugin::Refinement</dd>
            <dt>Status</dt><dd>Closed</dd>
            <dt>Close date</dt><dd>2006-03-27 16:57 <a href="http://cb.biplab.in/websvn/log.php?sr=2264"><span class="glyphicon glyphicon-link"></span></a></dd>
            <dt>Assigned to</dt><dd>&nbsp;</dd>
          </dl>
        </div>
      </div>
      <div class="highlight"><pre class="pre-scrollable"><span class="gh">Index: plugins/compilergcc/compilergcc.h</span>
<span class="gh">===================================================================</span>
<span class="gd">--- plugins/compilergcc/compilergcc.h    (revision 2256)</span>
<span class="gi">+++ plugins/compilergcc/compilergcc.h    (working copy)</span>
<span class="gu">@@ -157,7 +157,7 @@</span>
         wxString ProjectMakefile();
         void AddOutputLine(const wxString&amp; output, bool forceErrorColor = false);
         void PrintBanner(cbProject* prj = 0, ProjectBuildTarget* target = 0);
<span class="gd">-        bool UseMake(ProjectBuildTarget* target = 0);</span>
<span class="gi">+        bool UseMake(cbProject* project = 0);</span>
         bool CompilerValid(ProjectBuildTarget* target = 0);
         ProjectBuildTarget* GetBuildTargetForFile(ProjectFile* pf);
         ProjectBuildTarget* GetBuildTargetForFile(const wxString&amp; file);
<span class="gh">Index: plugins/compilergcc/compilergcc.cpp</span>
<span class="gh">===================================================================</span>
<span class="gd">--- plugins/compilergcc/compilergcc.cpp    (revision 2256)</span>
<span class="gi">+++ plugins/compilergcc/compilergcc.cpp    (working copy)</span>
<span class="gu">@@ -1171,14 +1171,19 @@</span>
     m_LastTempMakefile = _T(&quot;&quot;);
 }
 
<span class="gd">-bool CompilerGCC::UseMake(ProjectBuildTarget* target)</span>
<span class="gi">+bool CompilerGCC::UseMake(cbProject* project)</span>
 {
<span class="gd">-    if (!m_Project)</span>
<span class="gi">+    if (!m_Project &amp;&amp; !project)</span>
         return false;
<span class="gd">-    wxString idx = m_Project-&gt;GetCompilerID();</span>
<span class="gi">+</span>
<span class="gi">+    cbProject *prj = project;</span>
<span class="gi">+    if(!prj)</span>
<span class="gi">+        prj=m_Project;</span>
<span class="gi">+</span>
<span class="gi">+    wxString idx = prj-&gt;GetCompilerID();</span>
     if (CompilerFactory::GetCompiler(idx))
     {
<span class="gd">-        if (m_Project-&gt;IsMakefileCustom())</span>
<span class="gi">+        if (prj-&gt;IsMakefileCustom())</span>
             return true;
         else
         {
<span class="gu">@@ -1564,7 +1569,7 @@</span>
         wxSetWorkingDirectory(m_Project-&gt;GetBasePath());
     CompilerFactory::GetCompiler(m_CompilerId)-&gt;Init(m_Project);
 
<span class="gd">-    if (UseMake(target))</span>
<span class="gi">+    if (UseMake())</span>
     {
         wxString cmd = GetMakeCommandFor(mcClean, target);
         m_CommandQueue.Add(new CompilerCommand(cmd, wxEmptyString, m_Project, target));
<span class="gu">@@ -1618,7 +1623,7 @@</span>
         wxSetWorkingDirectory(m_Project-&gt;GetBasePath());
     CompilerFactory::GetCompiler(m_CompilerId)-&gt;Init(m_Project);
 
<span class="gd">-    if (UseMake(target))</span>
<span class="gi">+    if (UseMake())</span>
     {
         wxString cmd = GetMakeCommandFor(mcDistClean, target);
         m_CommandQueue.Add(new CompilerCommand(cmd, wxEmptyString, m_Project, target));
<span class="gu">@@ -1980,8 +1985,7 @@</span>
 
 //    Manager::Get()-&gt;GetMacrosManager()-&gt;Reset();
 
<span class="gd">-    wxString cmd;</span>
<span class="gd">-    if (UseMake(bt))</span>
<span class="gi">+    if (UseMake(prj))</span>
     {
         wxString cmd = GetMakeCommandFor(mcBuild, bt);
         m_CommandQueue.Add(new CompilerCommand(cmd, wxEmptyString, prj, bt));
<span class="gu">@@ -2068,7 +2072,7 @@</span>
     DoPrepareQueue();
 
     ProjectBuildTarget* bt = m_Project-&gt;GetBuildTarget(target);
<span class="gd">-    if (UseMake(bt))</span>
<span class="gi">+    if (UseMake())</span>
     {
         // make sure all project files are saved
         if (m_Project &amp;&amp; !m_Project-&gt;SaveAllFiles())
<span class="gu">@@ -2116,7 +2120,7 @@</span>
 
     CompilerFactory::GetCompiler(m_CompilerId)-&gt;Init(m_Project);
 
<span class="gd">-    if (UseMake(target))</span>
<span class="gi">+    if (UseMake())</span>
     {
         wxString cmd = GetMakeCommandFor(mcClean, target);
         m_CommandQueue.Add(new CompilerCommand(cmd, wxEmptyString, m_Project, target));
<span class="gu">@@ -2274,7 +2278,7 @@</span>
 
     ProjectFile* pf = m_Project ? m_Project-&gt;GetFileByFilename(file, true, false) : 0;
     ProjectBuildTarget* bt = GetBuildTargetForFile(pf);
<span class="gd">-    bool useMake = UseMake(bt);</span>
<span class="gi">+    bool useMake = UseMake();</span>
 
     if (!pf)
     {
</pre></div>

      <h4 class="page-header">History</h4>
      <div class="panel panel-default">
        <div class="panel-heading">yop 2006-03-25 20:16</div>
        <div class="panel-body">
          <p>This one changes the:</p>
          <p>bool CompilerGCC::UseMake(ProjectBuildTarget*)</p>
          <p>to:</p>
          <p>bool CompilerGCC::UseMake(cbProject* project)</p>
          <p>that I think is more appropriate as the custom Makefile property is per project. The current approach leads to problems when building workspaces as it would check if only the active project uses custom Makefiles. This patch came from my research on <a href="../bugs/6751.html" data-toggle="tooltip" title="Custom Makefiles are not used when building a workspace">bug #006751</a> where as I can see it will need more work to fix than I originally thought. Anyway this is a safe patch to apply, so I 'm commiting this one and hopefully I 'll squash <a href="../bugs/6751.html" data-toggle="tooltip" title="Custom Makefiles are not used when building a workspace">bug #006751</a>...</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">mandrav 2006-03-27 16:57</div>
        <div class="panel-body">
          <p>This patch will not be applied. It's easier to call this function with a ProjectBuildTarget* as argument.</p>
          <p>Besides, you seem to forgot/not-know about ProjectBuildTarget::GetParentProject()...</p>
          <p>The fix to the logic flaw however, to use the target's project instead of m_Project (which is the active one), has been applied. Thanks :)</p>
        </div>
      </div>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script>
      $(document).ready(function() {
        $("body").tooltip({ selector: '[data-toggle=tooltip]' });
      });
    </script>
  </body>
</html>