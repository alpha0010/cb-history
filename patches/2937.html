<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Patch 2937 - Code::Blocks History</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css">
  </head>
  <body role="document">
    <div class="navbar navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://www.codeblocks.org/">Code::Blocks</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../index.html">Home</a></li>
            <li><a href="../bugs.html">Bugs</a></li>
            <li><a href="../features.html">Features</a></li>
            <li class="active"><a href="../patches.html">Patches</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container" role="main">
      <div class="row">
        <div class="col-sm-8">
          <h3>Patch #2937 <small>2010-02-24 12:14</small></h3>
          <h4>thedmd</h4>
          Added ability to specify .def and import library filenames
          <dl class="dl-horizontal">
            <dt>Download</dt>
            <dd><a href="2937-Added_ability.patch">2937-Added_ability.patch</a> (40.4 KB)</dd>
          </dl>
        </div>
        <div class="col-sm-4">
          <dl class="dl-horizontal">
            <dt>Category</dt><dd>Application::FeatureAdd</dd>
            <dt>Status</dt><dd>Accepted</dd>
            <dt>Close date</dt><dd>2011-06-24 18:52 <a href="http://cb.biplab.in/websvn/log.php?sr=7252"><span class="glyphicon glyphicon-link"></span></a></dd>
            <dt>Assigned to</dt><dd>mortenmacfly</dd>
          </dl>
        </div>
      </div>
      <div class="highlight"><pre class="pre-scrollable"><span class="gh">Index: src/include/compiletargetbase.h</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/include/compiletargetbase.h    (revision 6178)</span>
<span class="gi">+++ src/include/compiletargetbase.h    (working copy)</span>
<span class="gu">@@ -114,6 +114,8 @@</span>
         virtual const wxString&amp; GetTitle() const; ///&lt; Read the target&#39;s title
         virtual void SetTitle(const wxString&amp; title); ///&lt; Set the target&#39;s title
         virtual void SetOutputFilename(const wxString&amp; filename); ///&lt; Set the target&#39;s output filename
<span class="gi">+        virtual void SetImportLibraryFilename(const wxString&amp; filename); ///&lt; Set the target&#39;s import library filename</span>
<span class="gi">+        virtual void SetDefinitionFileFilename(const wxString&amp; filename); ///&lt; Set the target&#39;s definition file filename</span>
         virtual void SetWorkingDir(const wxString&amp; dirname); ///&lt; Set the target&#39;s working dir on execution (valid only for executable targets)
         virtual void SetObjectOutput(const wxString&amp; dirname); ///&lt; Set the target&#39;s objects output dir
         virtual void SetDepsOutput(const wxString&amp; dirname); ///&lt; Set the target&#39;s dependencies output dir
<span class="gu">@@ -126,6 +128,7 @@</span>
         virtual wxString SuggestOutputFilename(); ///&lt; Suggest a filename based on the target&#39;s type
         virtual wxString GetExecutableFilename() const; ///&lt; Read the target&#39;s executable filename (produced if target type is ttExecutable)
         virtual wxString GetDynamicLibFilename(); ///&lt; Read the target&#39;s dynamic library filename (produced if target type is ttDynamicLib)
<span class="gi">+        virtual wxString GetDynamicLibImportFilename(); ///&lt; Read the target&#39;s dynamic library import filename (produced if target type is ttDynamicLib)</span>
         virtual wxString GetDynamicLibDefFilename(); ///&lt; Read the target&#39;s dynamic library definition file filename (produced if target type is ttDynamicLib)
         virtual wxString GetStaticLibFilename(); ///&lt; Read the target&#39;s static library filename (produced if target type is ttStaticLib)
         virtual wxString GetNativeFilename(); ///&lt; Read the target&#39;s native filename (produced if target type is ttNative)
<span class="gu">@@ -147,6 +150,8 @@</span>
         wxString m_Filename;
         wxString m_Title;
         wxString m_OutputFilename;
<span class="gi">+        wxString m_ImportLibraryFilename;</span>
<span class="gi">+        wxString m_DefinitionFileFilename;</span>
         wxString m_WorkingDir;
         wxString m_ObjectOutput;
         wxString m_DepsOutput;
<span class="gh">Index: src/include/macrosmanager.h</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/include/macrosmanager.h    (revision 6178)</span>
<span class="gi">+++ src/include/macrosmanager.h    (working copy)</span>
<span class="gu">@@ -58,6 +58,7 @@</span>
     wxString            m_TargetOutputDir;
     wxString            m_TargetName;
     wxString            m_TargetOutputBaseName;
<span class="gi">+    wxString            m_TargetOutputFilename;</span>
     wxString            m_TargetFilename;

     MacrosMap           m_Macros;
<span class="gh">Index: src/include/projectoptionsdlg.h</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/include/projectoptionsdlg.h    (revision 6178)</span>
<span class="gi">+++ src/include/projectoptionsdlg.h    (working copy)</span>
<span class="gu">@@ -35,6 +35,8 @@</span>
         void OnCopyBuildTargetClick(wxCommandEvent&amp; event);
         void OnRemoveBuildTargetClick(wxCommandEvent&amp; event);
         void OnBrowseOutputFilenameClick(wxCommandEvent&amp; event);
<span class="gi">+        void OnBrowseImportLibraryFilenameClick(wxCommandEvent&amp; event);</span>
<span class="gi">+        void OnBrowseDefinitionFileFilenameClick(wxCommandEvent&amp; event);</span>
         void OnBrowseDirClick(wxCommandEvent&amp; event);
         void OnVirtualTargets(wxCommandEvent&amp; event);
         void OnEditDepsClick(wxCommandEvent&amp; event);
<span class="gu">@@ -46,6 +48,8 @@</span>
         void OnPlatform(wxCommandEvent&amp; event);
         void OnUpdateUI(wxUpdateUIEvent&amp; event);
         void OnOK(wxCommandEvent&amp; event);
<span class="gi">+        void OnCreateDefFileClick(wxCommandEvent&amp; event);</span>
<span class="gi">+        void OnCreateImportFileClick(wxCommandEvent&amp; event);</span>

         void OnScriptsOverviewSelChanged(wxTreeEvent&amp; event);
         void OnCheckScripts(wxCommandEvent&amp; event);
<span class="gh">Index: src/sdk/compilercommandgenerator.cpp</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/sdk/compilercommandgenerator.cpp    (revision 6178)</span>
<span class="gi">+++ src/sdk/compilercommandgenerator.cpp    (working copy)</span>
<span class="gu">@@ -447,47 +447,106 @@</span>
     FixPathSeparators(compiler, result);
     m_Output[target] = result;

<span class="gd">-    // Replace Variables FIRST to address the $(VARIABLE)libfoo.a problem</span>
<span class="gd">-    // if $(VARIABLE) expands to /bar/ then wxFileName will still consider $(VARIABLE)libfoo.a a filename,</span>
<span class="gd">-    // not a fully qualified path, so we will prepend lib to /bar/libfoo.a incorrectly</span>
<span class="gd">-    // NOTE (thomas#1#): A better solution might be to use a regex, but finding an universal regex might not be easy...</span>
<span class="gd">-    wxString fnameString(target-&gt;GetOutputFilename());</span>
<span class="gd">-    Manager::Get()-&gt;GetMacrosManager()-&gt;ReplaceMacros(fnameString, target);</span>
<span class="gd">-    wxFileName fname(fnameString);</span>
<span class="gi">+    // static/import library name</span>
<span class="gi">+    switch (target-&gt;GetTargetType())</span>
<span class="gi">+    {</span>
<span class="gi">+        case ttDynamicLib:</span>
<span class="gi">+</span>
<em><strong>file truncated...</strong></em>
</pre></div>

      <h4 class="page-header">History</h4>
      <div class="panel panel-default">
        <div class="panel-heading">mortenmacfly 2010-02-26 17:01</div>
        <div class="panel-body">
          <p>Here is an issue:</p>
          <p>If I compile a dynamic library and want to automatically create the prefix and extension and have enabled "create import library" and "create def file" and my output file does look like: "MyLib" the def file will overwrite the include library without any warning. You'll notice a linker error that "the format could be recognised" when you try to link against the import lib.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">thedmd 2010-02-26 21:30</div>
        <div class="panel-body">
          <p>It may sounds strange, but it is correct behavior. This is just invalid configuration. I do not wish to introduce artificial limits. In all regular scenarios users setup reasonable configurations. Probably some warning may be produced.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">mortenmacfly 2010-02-27 19:53</div>
        <div class="panel-body">
          <p>Please allow me an objection hereby:</p>
          <p>I doubt that this will be considered as "correct".</p>
          <p>If I want to have C::B take care about prefix and suffix and provide just the (middle) name compilation should really work. Otherwise the checkboxes simply don't do what a users intention is.</p>
          <p>BTW: We had discussed these issues already a long time in the past. This must be bullet (and fool) proof.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">thedmd 2010-02-28 12:25</div>
        <div class="panel-body">
          <p>I misunderstand you. I thought you were taking about case when both checkboxes are unchecked. Try it now, I fixed that error.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">thedmd 2010-02-28 12:26</div>
        <div class="panel-body">
          <p>Ups, forgotten to check "upload" box.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">thedmd 2010-03-06 13:02</div>
        <div class="panel-body">
          <p>Do you have the opportunity to review this patch?</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">mortenmacfly 2010-03-08 11:54</div>
        <div class="panel-body">
          <p>I cannot compile C::B anymore after applying the new version. Compilation failes here:</p>
          <p>wxString requested_ext = "def";</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">thedmd 2010-03-08 12:04</div>
        <div class="panel-body">
          <p>My bad. "def" should be enclosed in _T(). Not it is fixed.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">thedmd 2010-04-02 17:54</div>
        <div class="panel-body">
          <p>May I ask you for review this patch again?</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">mortenmacfly 2010-04-06 19:08</div>
        <div class="panel-body">
          <p>What do you mean by "review"? I don't see the patch has updated since March. If you mean to review your last update - don't worry, I did. I still have it applied in my local copy and use it in daily environment for testing. So far I have no complaints, otherwise I'll post here, of course.</p>
          <p>I tried to reproduce the issue you said you've fixed and indeed it seems not to happen anymore.</p>
          <p>However, Linux/Mac testing is missing which is a must! Hence I don't have time for this atm. As you are surely aware we are in feature freeze, so this won't make it into the release. But after that I am open for public testing/discussion through nightlies (if needed).</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">thedmd 2010-04-07 06:24</div>
        <div class="panel-body">
          <p>Yes, patch was not update because it should be complete in the way it is now. I had asked to clarify the status of this patch.</p>
          <p>I was not aware about feature freeze. I was also not aware about the fact that you are using this path on daily basis. I'm pleased that it works for you.</p>
          <p>I will be happy to see it in nightlies after release. Since I have no daily access to Mac nor Linux.</p>
          <p>Thanks for response.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">mortenmacfly 2011-06-24 18:52</div>
        <div class="panel-body">
          <p>Applied in trunk meanwhile.</p>
        </div>
      </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
  </body>
</html>
