<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Patch 1066 - Code::Blocks History</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">

    <link rel="stylesheet" href="../pygments.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="navbar navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://www.codeblocks.org/">Code::Blocks</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../index.html">Home</a></li>
            <li><a href="../bugs.html">Bugs</a></li>
            <li><a href="../features.html">Features</a></li>
            <li class="active"><a href="../patches.html">Patches</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container" role="main">
      <div class="row">
        <div class="col-sm-8">
          <h3>Patch #1066 <small>2006-05-22 17:01</small></h3>
          <h4>pchris</h4>
          Dynamic column width setting
          <dl class="dl-horizontal">
            <dt>Download</dt>
            <dd><a href="1066-Dynamic_column.patch">1066-Dynamic_column.patch</a> (2.2 KB)</dd>
          </dl>
        </div>
        <div class="col-sm-4">
          <dl class="dl-horizontal">
            <dt>Category</dt><dd>Application::Refinement</dd>
            <dt>Status</dt><dd>Rejected</dd>
            <dt>Close date</dt><dd>2006-06-05 11:52</dd>
            <dt>Assigned to</dt><dd>&nbsp;</dd>
          </dl>
        </div>
      </div>
      <div class="highlight"><pre class="pre-scrollable"><span class="gh">Index: src/sdk/cbeditor.cpp</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/sdk/cbeditor.cpp    (revision 2484)</span>
<span class="gi">+++ src/sdk/cbeditor.cpp    (working copy)</span>
<span class="gu">@@ -123,7 +123,8 @@</span>
         m_ensure_consistent_line_ends(true),
         m_LastMarginMenuLine(-1),
         m_LastDebugLine(-1),
<span class="gd">-        m_useByteOrderMark(false)</span>
<span class="gi">+        m_useByteOrderMark(false),</span>
<span class="gi">+        lineNumbersWidth(0)</span>
     {
         m_encoding = wxLocale::GetSystemEncoding();
     }
<span class="gu">@@ -248,6 +249,27 @@</span>
         control-&gt;ConvertEOLs(control-&gt;GetEOLMode());
     }
 
<span class="gi">+    /** Set line number column width */</span>
<span class="gi">+    void SetLineNumberColWidth()</span>
<span class="gi">+    {</span>
<span class="gi">+        int lineCount = 0;</span>
<span class="gi">+        lineCount = m_pOwner-&gt;m_pControl-&gt;GetLineCount();</span>
<span class="gi">+</span>
<span class="gi">+        int lineNumWidth = 1;</span>
<span class="gi">+        while (lineCount &gt;= 10)</span>
<span class="gi">+        {</span>
<span class="gi">+            lineCount /= 10;</span>
<span class="gi">+            ++lineNumWidth;</span>
<span class="gi">+        }</span>
<span class="gi">+</span>
<span class="gi">+        if (lineNumWidth != lineNumbersWidth) {</span>
<span class="gi">+            int pixels = 0;</span>
<span class="gi">+            pixels = 5 + lineNumWidth * 8;</span>
<span class="gi">+            m_pOwner-&gt;m_pControl-&gt;SetMarginWidth(0, pixels);</span>
<span class="gi">+            lineNumbersWidth = lineNumWidth;</span>
<span class="gi">+        }</span>
<span class="gi">+    }</span>
<span class="gi">+</span>
     //vars
     bool m_strip_trailing_spaces;
     bool m_ensure_final_line_end;
<span class="gu">@@ -259,6 +281,8 @@</span>
     wxFontEncoding m_encoding;
     bool m_useByteOrderMark;
 
<span class="gi">+    int lineNumbersWidth;</span>
<span class="gi">+</span>
 };
 ////////////////////////////////////////////////////////////////////////////////
 
<span class="gu">@@ -350,8 +374,8 @@</span>
 //    Manager::Get()-&gt;GetMessageManager()-&gt;DebugLog(_T(&quot;ctor: Filename=%s\nShort=%s&quot;), m_Filename.c_str(), m_Shortname.c_str());
 
     CreateEditor();
<span class="gi">+    m_IsOK = Open();</span>
     SetEditorStyle();
<span class="gd">-    m_IsOK = Open();</span>
 
     // if !m_IsOK then it&#39;s a new file, so set the modified flag ON
     if (!m_IsOK &amp;&amp; filename.IsEmpty())
<span class="gu">@@ -579,7 +603,7 @@</span>
     // line numbering
     m_pControl-&gt;SetMarginType(0, wxSCI_MARGIN_NUMBER);
        if (mgr-&gt;ReadBool(_T(&quot;/show_line_numbers&quot;), true))
<span class="gd">-        m_pControl-&gt;SetMarginWidth(0, 48);</span>
<span class="gi">+        m_pData-&gt;SetLineNumberColWidth();</span>
     else
         m_pControl-&gt;SetMarginWidth(0, 0);
 
<span class="gu">@@ -1870,6 +1894,9 @@</span>
 
             line = m_pControl-&gt;MarkerPrevious(line - 1, 1 &lt;&lt; BREAKPOINT_MARKER);
         }
<span class="gi">+</span>
<span class="gi">+        // Adjust line numbers column</span>
<span class="gi">+        m_pData-&gt;SetLineNumberColWidth();</span>
     }
 }
 
</pre></div>

      <h4 class="page-header">History</h4>
      <div class="panel panel-default">
        <div class="panel-heading">thomasdenk 2006-05-22 17:38</div>
        <div class="panel-body">
          <p>Not acceptable as it is, sorry.</p>
          <p>First, the patch implements a behaviour that is the opposite of the standard behaviour and only wanted by a tiny fraction.</p>
          <p>This would not be a problem as such if it were an option,  but the patch completely supersedes the correct behaviour and does not offer any possibility to revert to the original.</p>
          <p>Second, the width calculation is hardcoded using device-dependent coordinates (assuming a character width of 8 pixels). This will very likely not work well across different platforms.</p>
          <p>Yes, the original implemetation hardcodes the column width too, but that is another situation. The width in the original implementation was chosen large enough to easily accomodate all "normal" cases.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">pchris 2006-05-22 17:44</div>
        <div class="panel-body">
          <p>I understand what you mean.</p>
          <p>The character width is my stupidness... It was intended to be dynamically allocated, however I forgot about it while testing. *sigh*</p>
          <p>Is it an acceptable solution, if I add a checkbox to the Settings window saying "Set column width dynamically"?</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">thomasdenk 2006-05-22 18:30</div>
        <div class="panel-body">
          <p>With those two changes, I guess there is not much left to object.</p>
          <p>Personally, I don't like the proposed feature at all (in fact I think it is misbehaviour), but then... to each according to his needs.</p>
          <p>If it is configurable and if it is not the default, no problem. :)</p>
          <p>Please update before making any changes, though, Sethjackson's last patch modified the XRC file, and it is already in the repository, so your modifications will provoke conflicts if you don't update first.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">mandrav 2006-06-05 11:52</div>
        <div class="panel-body">
          <p>Applied a more recent patch (or so I think!).</p>
        </div>
      </div>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
  </body>
</html>