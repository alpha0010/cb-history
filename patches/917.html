<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Patch 917 - Code::Blocks History</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="../pygments.css">
  </head>
  <body role="document">
    <div class="navbar navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://www.codeblocks.org/">Code::Blocks</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../index.html">Home</a></li>
            <li><a href="../bugs.html">Bugs</a></li>
            <li><a href="../features.html">Features</a></li>
            <li class="active"><a href="../patches.html">Patches</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container" role="main">
      <div class="row">
        <div class="col-sm-8">
          <h3>Patch #917 <small>2006-03-12 17:00</small></h3>
          <h4>pecan</h4>
          Allow others to Enable/Disable items on toolbar
          <dl class="dl-horizontal">
            <dt>Download</dt>
            <dd><a href="917-Allow_others_to.patch">917-Allow_others_to.patch</a> (7.8 KB)</dd>
          </dl>
        </div>
        <div class="col-sm-4">
          <dl class="dl-horizontal">
            <dt>Category</dt><dd>&nbsp;</dd>
            <dt>Status</dt><dd>Out of date</dd>
            <dt>Close date</dt><dd>2007-04-12 11:29</dd>
            <dt>Assigned to</dt><dd>&nbsp;</dd>
          </dl>
        </div>
      </div>
      <div class="highlight"><pre class="pre-scrollable"><span class="gh">Index: src/sdk/manager.cpp</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/sdk/manager.cpp    (revision 2174)</span>
<span class="gi">+++ src/sdk/manager.cpp    (working copy)</span>
<span class="gu">@@ -50,6 +50,11 @@</span>
 
 #include &lt;wx/toolbar.h&gt;
 
<span class="gi">+int idEditUndo = XRCID(&quot;idEditUndo&quot;);</span>
<span class="gi">+int idEditRedo = XRCID(&quot;idEditRedo&quot;);</span>
<span class="gi">+int idEditCopy = XRCID(&quot;idEditCopy&quot;);</span>
<span class="gi">+int idEditCut = XRCID(&quot;idEditCut&quot;);</span>
<span class="gi">+int idEditPaste = XRCID(&quot;idEditPaste&quot;);</span>
 
 
 
<span class="gu">@@ -281,7 +286,80 @@</span>
     return CfgMgrBldr::GetConfigManager(name_space);
 }
 
<span class="gi">+// Allow others to request to disable/enable items on the main toolbar      //pecan 2006/03/13</span>
<span class="gi">+void Manager::SetMainMenuRequest(bool Enable, int MenuItem )            //pecan 2006/03/13</span>
<span class="gi">+{</span>
<span class="gi">+    if (Enable)</span>
<span class="gi">+    {</span>
<span class="gi">+        if (MenuItem == idEditUndo)  ++MenuUndoSetRequests;</span>
<span class="gi">+        if (MenuItem == idEditRedo)  ++MenuRedoSetRequests;</span>
<span class="gi">+        if (MenuItem == idEditCopy)  ++MenuCopySetRequests;</span>
<span class="gi">+        if (MenuItem == idEditCut )  ++MenuCutSetRequests;</span>
<span class="gi">+        if (MenuItem == idEditPaste) ++MenuPasteSetRequests;</span>
<span class="gi">+    }</span>
<span class="gi">+    else</span>
<span class="gi">+    {</span>
<span class="gi">+        if (MenuItem == idEditUndo)  {if (MenuUndoSetRequests)  --MenuUndoSetRequests;  }</span>
<span class="gi">+        if (MenuItem == idEditRedo)  {if (MenuRedoSetRequests)  --MenuRedoSetRequests;  }</span>
<span class="gi">+        if (MenuItem == idEditCopy)  {if (MenuCopySetRequests)  --MenuCopySetRequests;  }</span>
<span class="gi">+        if (MenuItem == idEditCut )  {if (MenuCutSetRequests)   --MenuCutSetRequests;   }</span>
<span class="gi">+        if (MenuItem == idEditPaste) {if (MenuPasteSetRequests) --MenuPasteSetRequests; }</span>
<span class="gi">+    }</span>
<span class="gi">+}</span>
<span class="gi">+void Manager::SetMainToolbarRequest(bool Enable, int ToolbarItem )      //pecan 2006/03/13</span>
<span class="gi">+{</span>
<span class="gi">+    if (Enable)</span>
<span class="gi">+    {</span>
<span class="gi">+        if (ToolbarItem == idEditUndo)  ++ToolbarUndoSetRequests;</span>
<span class="gi">+        if (ToolbarItem == idEditRedo)  ++ToolbarRedoSetRequests;</span>
<span class="gi">+        if (ToolbarItem == idEditCopy)  ++ToolbarCopySetRequests;</span>
<span class="gi">+        if (ToolbarItem == idEditCut )  ++ToolbarCutSetRequests;</span>
<span class="gi">+        if (ToolbarItem == idEditPaste) ++ToolbarPasteSetRequests;</span>
<span class="gi">+    }</span>
<span class="gi">+    else</span>
<span class="gi">+    {</span>
<span class="gi">+        if (ToolbarItem == idEditUndo)  {if (ToolbarUndoSetRequests)  --ToolbarUndoSetRequests;  }</span>
<span class="gi">+        if (ToolbarItem == idEditRedo)  {if (ToolbarRedoSetRequests)  --ToolbarRedoSetRequests;  }</span>
<span class="gi">+        if (ToolbarItem == idEditCopy)  {if (ToolbarCopySetRequests)  --ToolbarCopySetRequests;  }</span>
<span class="gi">+        if (ToolbarItem == idEditCut )  {if (ToolbarCutSetRequests)   --ToolbarCutSetRequests;   }</span>
<span class="gi">+        if (ToolbarItem == idEditPaste) {if (ToolbarPasteSetRequests) --ToolbarPasteSetRequests; }</span>
<span class="gi">+    }</span>
<span class="gi">+}</span>
 
<span class="gi">+// Return count of disable/enable request for the main toolbar              //pecan 2006/03/13</span>
<span class="gi">+int  Manager::GetMainMenuSetRequests(int MenuItem)                          //pecan 2006/03/13</span>
<span class="gi">+{</span>
<span class="gi">+    if (MenuItem == idEditUndo)  return MenuUndoSetRequests;</span>
<span class="gi">+    if (MenuItem == idEditRedo)  return MenuRedoSetRequests;</span>
<span class="gi">+    if (MenuItem == idEditCopy)  return MenuCopySetRequests;</span>
<span class="gi">+    if (MenuItem == idEditCut )  return MenuCutSetRequests;</span>
<span class="gi">+    if (MenuItem == idEditPaste) return MenuPasteSetRequests;</span>
<span class="gi">+    return 0;</span>
<span class="gi">+}</span>
<span class="gi">+int  Manager::GetMainToolbarSetRequests(int ToolbarItem)                    //pecan 2006/03/13</span>
<span class="gi">+{</span>
<span class="gi">+    if (ToolbarItem == idEditUndo)  return ToolbarUndoSetRequests;</span>
<span class="gi">+    if (ToolbarItem == idEditRedo)  return ToolbarRedoSetRequests;</span>
<span class="gi">+    if (ToolbarItem == idEditCopy)  return ToolbarCopySetRequests;</span>
<span class="gi">+    if (ToolbarItem == idEditCut )  return ToolbarCutSetRequests;</span>
<span class="gi">+    if (ToolbarItem == idEditPaste) return ToolbarPasteSetRequests;</span>
<span class="gi">+    return 0;</span>
<span class="gi">+}</span>
<span class="gi">+</span>
 bool Manager::appShuttingDown = false;
 bool Manager::blockYields = false;
 bool Manager::isBatch = false;
<span class="gi">+</span>
<span class="gi">+// Reference counts of requests to set Menu/Tool items</span>
<span class="gi">+// from plugins and other windows</span>
<span class="gi">+int  Manager::MenuUndoSetRequests     = 0;</span>
<span class="gi">+int  Manager::MenuRedoSetRequests     = 0;</span>
<span class="gi">+int  Manager::MenuCutSetRequests      = 0;</span>
<span class="gi">+int  Manager::MenuCopySetRequests     = 0;</span>
<span class="gi">+int  Manager::MenuPasteSetRequests    = 0;</span>
<span class="gi">+</span>
<span class="gi">+int  Manager::ToolbarUndoSetRequests  = 0;</span>
<span class="gi">+int  Manager::ToolbarRedoSetRequests  = 0;</span>
<span class="gi">+int  Manager::ToolbarCutSetRequests   = 0;</span>
<span class="gi">+int  Manager::ToolbarCopySetRequests  = 0;</span>
<span class="gi">+int  Manager::ToolbarPasteSetRequests = 0;</span>
<span class="gh">Index: src/sdk/manager.h</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/sdk/manager.h    (revision 2174)</span>
<span class="gi">+++ src/sdk/manager.h    (working copy)</span>
<span class="gu">@@ -39,7 +39,19 @@</span>
     static bool appShuttingDown;
     static bool blockYields;
     static bool isBatch;
<span class="gi">+    static int  Manager::MenuUndoSetRequests;                  //pecan 2006/03/13</span>
<span class="gi">+    static int  Manager::MenuRedoSetRequests;</span>
<span class="gi">+    static int  Manager::MenuCutSetRequests;</span>
<span class="gi">+    static int  Manager::MenuCopySetRequests;</span>
<span class="gi">+    static int  Manager::MenuPasteSetRequests;</span>
 
<span class="gi">+    static int  Manager::ToolbarUndoSetRequests;</span>
<span class="gi">+    static int  Manager::ToolbarRedoSetRequests;</span>
<span class="gi">+    static int  Manager::ToolbarCutSetRequests;</span>
<span class="gi">+    static int  Manager::ToolbarCopySetRequests;</span>
<span class="gi">+    static int  Manager::ToolbarPasteSetRequests;</span>
<span class="gi">+</span>
<span class="gi">+</span>
     Manager();
     ~Manager();
 
<span class="gu">@@ -115,6 +127,13 @@</span>
<em><strong>download for full patch...</strong></em>
</pre></div>

      <h4 class="page-header">History</h4>
      <div class="panel panel-default">
        <div class="panel-heading">pecan 2006-03-12 17:01</div>
        <div class="panel-body">
          <p>Since SetToolBar() cannot be used in CodeBlocks without</p>
          <p>mangling the layout, this patch sets the MainFrame</p>
          <p>toolbar address in Manager so a user/plugin can use</p>
          <p>Manager::Get()-&gt;GetMainToolbar(). It allows the user</p>
          <p>to enable/disable cut/copy/paste etc.</p>
          <p>thanks</p>
          <p>pecan</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">mandrav 2006-03-13 09:54</div>
        <div class="panel-body">
          <p>Plugins are not allowed to alter toolbar items not belonging to them.</p>
          <p>What would this help you to achieve?</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">pecan 2006-03-13 15:07</div>
        <div class="panel-body">
          <p>I'm writing a plugin to copy/paste/drag/drop items to/from the project windows panel.  I'ts called ScrapList (using treeListCtrl like a scrap book), and holds items that can fall off the "recent" menu items.</p>
          <p>In future, it will hold snippets of code dragged from the editors, file/project/workspace names copied/dragged from the project panels, and editor marks set by bookmark/debugger etc. These will all be reset by dragging/copying back into the project panels.</p>
          <p>It needs to enable/disable copy/paste drag/drop from both the menu items (already done) and the toolbar items to be consistent. This is done by chaining drag/drop and handing them off to the MainFrame drag/drop target. MainFrame thinks the user did it from the menu/toolbar.</p>
          <p>It seems to me that a printer plugin should be able to enable the printer icon on the tool bar; that a cut/paste plugin on any window should be able to set copy/paste etc.</p>
          <p>I could put up a toolbar but I  think it'd look awfully dumb for plugins to put up multiple toolbars/menus with copy/paste on 'em.</p>
          <p>thanks</p>
          <p>pecan</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">pecan 2006-03-13 21:22</div>
        <div class="panel-body">
          <p>Been playing in the CB debugger. It sure would be nice if the debugger would enable copy/paste so we could document some of our bugs. As it is now, I have to get out of the CB debugger and back into the command line GDB to copy/paste a backtrace.</p>
          <p>The menu copy/paste and (most) tool bar items are used so ubiqitously that any serious plugin should be able to offer its services to the user.</p>
          <p>It is going to be so confusing to the user to have to choose between toolbars for common actions.</p>
          <p>If directly manipulating a "non-owned" windows toolbar is not acceptable, is there something that I could code up that would allow arbiter code to hide or show or grant requests to show/enable/disable items on the main toolbar?</p>
          <p>thanks</p>
          <p>pecan</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">pecan 2006-03-13 21:56</div>
        <div class="panel-body">
          <p>How about an interface call from plugins to Manager that request enable/disabling the menu/tool bar cut/copy/paste/print/do/undo items.</p>
          <p>Something like "Manager::Get-&gt;PleaseEnable(menucopyitem | toolbarpasteitem);"  Or Manager::Get-&gt;PleaseDisable...etc etc.</p>
          <p>Manger could monitor the situation with reference counting like freeze/thaw. MainFrame::UpdateUI would look at the request flags kept by Manager and enable/disable as it sees fit.</p>
          <p>Thanks</p>
          <p>pecan</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">pecan 2006-03-14 06:03</div>
        <div class="panel-body">
          <p>I have re-written the patch so that others can  *requests*  MainFrame::UpdateUI to enable/disable the menu/toolbar cut/copy/paste/undo/redo.</p>
          <p>I hope this is more acceptable to the CB philosophy.</p>
          <p>thanks</p>
          <p>pecan</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">mandrav 2006-03-14 22:01</div>
        <div class="panel-body">
          <p>OK, I see your point, although I think your DragScroll plugin will "betray" you here since it auto-focuses the editor window ;)</p>
          <p>Let me think it over. I 'd like to generalize this a bit...</p>
        </div>
      </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
  </body>
</html>
