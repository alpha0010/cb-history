<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Patch 3241 - Code::Blocks History</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">

    <link rel="stylesheet" href="../pygments.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="navbar navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://www.codeblocks.org/">Code::Blocks</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../index.html">Home</a></li>
            <li><a href="../bugs.html">Bugs</a></li>
            <li><a href="../features.html">Features</a></li>
            <li class="active"><a href="../patches.html">Patches</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container" role="main">
      <div class="row">
        <div class="col-sm-8">
          <h3>Patch #3241 <small>2011-12-11 15:29</small></h3>
          <h4>nevelo</h4>
          Support for MIPS GDB &amp; ability to run an ext tool to break.
          <dl class="dl-horizontal">
            <dt>Download</dt>
            <dd><a href="3241-Support_for_MI.patch">3241-Support_for_MI.patch</a> (15.1 KB)</dd>
          </dl>
        </div>
        <div class="col-sm-4">
          <dl class="dl-horizontal">
            <dt>Category</dt><dd>Plugin::FeatureAdd</dd>
            <dt>Status</dt><dd>Open</dd>
            <dt>Close date</dt><dd>&nbsp;</dd>
            <dt>Assigned to</dt><dd>tpetrov</dd>
          </dl>
        </div>
      </div>
      <div class="highlight"><pre class="pre-scrollable"><span class="gh">Index: debuggergdb.cpp</span>
<span class="gh">===================================================================</span>
<span class="gd">--- debuggergdb.cpp    (revision 7632)</span>
<span class="gi">+++ debuggergdb.cpp    (working copy)</span>
<span class="gu">@@ -2110,21 +2110,33 @@</span>
         else
             wxKill(pid, wxSIGINT);
     #else
<span class="gd">-        // windows gdb can interrupt the running process too. yay!</span>
<span class="gd">-        bool done = false;</span>
<span class="gd">-        if (DebugBreakProcessFunc &amp;&amp; pid &gt; 0)</span>
<span class="gd">-        {</span>
<span class="gd">-            Log(_(&quot;Trying to pause the running process...&quot;));</span>
<span class="gd">-            HANDLE proc = OpenProcess(PROCESS_ALL_ACCESS, FALSE, (DWORD)pid);</span>
<span class="gd">-            if (proc)</span>
<span class="gd">-            {</span>
<span class="gd">-                DebugBreakProcessFunc(proc); // yay!</span>
<span class="gd">-                CloseHandle(proc);</span>
<span class="gd">-                done = true;</span>
<span class="gd">-            }</span>
<span class="gd">-            else</span>
<span class="gd">-                Log(_(&quot;Failed.&quot;));</span>
<span class="gd">-        }</span>
<span class="gi">+</span>
<span class="gi">+        wxString run_tool_on_break = Manager::Get()-&gt;GetConfigManager(_T(&quot;debugger&quot;))-&gt;Read(_T(&quot;run_tool_on_break&quot;), wxEmptyString);</span>
<span class="gi">+</span>
<span class="gi">+        // Sometimes with embedded systems you need to run some other tool to trigger an asynchronous break</span>
<span class="gi">+        if (run_tool_on_break != wxEmptyString)</span>
<span class="gi">+        {</span>
<span class="gi">+            Log(wxString::Format(_T(&quot;Starting external tool to break execution (%s)...&quot;), run_tool_on_break.c_str()));</span>
<span class="gi">+            system(run_tool_on_break.ToAscii());</span>
<span class="gi">+        }</span>
<span class="gi">+        else</span>
<span class="gi">+        {</span>
<span class="gi">+            // windows gdb can interrupt the running process too. yay!</span>
<span class="gi">+            bool done = false;</span>
<span class="gi">+            if (DebugBreakProcessFunc &amp;&amp; pid &gt; 0)</span>
<span class="gi">+            {</span>
<span class="gi">+                Log(_(&quot;Trying to pause the running process...&quot;));</span>
<span class="gi">+                HANDLE proc = OpenProcess(PROCESS_ALL_ACCESS, FALSE, (DWORD)pid);</span>
<span class="gi">+                if (proc)</span>
<span class="gi">+                {</span>
<span class="gi">+                    DebugBreakProcessFunc(proc); // yay!</span>
<span class="gi">+                    CloseHandle(proc);</span>
<span class="gi">+                    done = true;</span>
<span class="gi">+                }</span>
<span class="gi">+                else</span>
<span class="gi">+                    Log(_(&quot;Failed.&quot;));</span>
<span class="gi">+            }</span>
<span class="gi">+        }</span>
     #endif
         // Notify debugger plugins for end of debug session
         PluginManager *plm = Manager::Get()-&gt;GetPluginManager();
<span class="gh">Index: debuggeroptionsdlg.cpp</span>
<span class="gh">===================================================================</span>
<span class="gd">--- debuggeroptionsdlg.cpp    (revision 7632)</span>
<span class="gi">+++ debuggeroptionsdlg.cpp    (working copy)</span>
<span class="gu">@@ -39,6 +39,7 @@</span>
     XRCCTRL(*this, &quot;choDisassemblyFlavor&quot;, wxChoice)-&gt;SetSelection(cfg-&gt;ReadInt(_T(&quot;disassembly_flavor&quot;), 0));
     XRCCTRL(*this, &quot;txtInstructionSet&quot;, wxTextCtrl)-&gt;SetValue(cfg-&gt;Read(_T(&quot;instruction_set&quot;), wxEmptyString));
     XRCCTRL(*this, &quot;spnArrayElems&quot;,     wxSpinCtrl)-&gt;SetValue(cfg-&gt;ReadInt(_T(&quot;single_line_array_elem_count&quot;), 8));
<span class="gi">+    XRCCTRL(*this, &quot;txtRunExtToolOnBreak&quot;, wxTextCtrl)-&gt;SetValue(cfg-&gt;Read(_T(&quot;run_tool_on_break&quot;), wxEmptyString));</span>
 }
 
 DebuggerOptionsDlg::~DebuggerOptionsDlg()
<span class="gu">@@ -62,6 +63,7 @@</span>
     cfg-&gt;Write(_T(&quot;disassembly_flavor&quot;),    XRCCTRL(*this, &quot;choDisassemblyFlavor&quot;, wxChoice)-&gt;GetSelection());
     cfg-&gt;Write(_T(&quot;instruction_set&quot;),       XRCCTRL(*this, &quot;txtInstructionSet&quot;, wxTextCtrl)-&gt;GetValue());
     cfg-&gt;Write(_T(&quot;single_line_array_elem_count&quot;), XRCCTRL(*this, &quot;spnArrayElems&quot;, wxSpinCtrl)-&gt;GetValue());
<span class="gi">+    cfg-&gt;Write(_T(&quot;run_tool_on_break&quot;),     XRCCTRL(*this, &quot;txtRunExtToolOnBreak&quot;, wxTextCtrl)-&gt;GetValue());</span>
 
     m_pPlugin-&gt;RefreshConfiguration();
 }
<span class="gh">Index: gdb_commands.h</span>
<span class="gh">===================================================================</span>
<span class="gd">--- gdb_commands.h    (revision 7632)</span>
<span class="gi">+++ gdb_commands.h    (working copy)</span>
<span class="gu">@@ -150,13 +150,13 @@</span>
 //  ebx at 0x22ff6c, ebp at 0x22ff78, esi at 0x22ff70, edi at 0x22ff74, eip at 0x22ff7c
 static wxRegEx reDisassemblyInit(_T(&quot;^Stack level [0-9]+, frame at (0x[A-Fa-f0-9]+):&quot;));
 static wxRegEx reDisassemblyInitFunc(_T(&quot;eip = (0x[A-Fa-f0-9]+) in ([^;]*)&quot;));
<span class="gd">-// or32 variant</span>
<span class="gi">+// or32/mips variant</span>
 #ifdef __WXMSW__
<span class="gd">-static wxRegEx reDisassemblyInitFuncOR32(_T(&quot;PC = (0x[A-Fa-f0-9]+) in ([^;]*)&quot;));</span>
<span class="gi">+static wxRegEx reDisassemblyInitFuncOR32_MIPS(_T(&quot;PC = (0x[A-Fa-f0-9]+) in ([^;]*)&quot;));</span>
 #else
 // not used on linux, but make sure it exists otherwise compilation fails on linux
 // if(platform::windows &amp;&amp; m_disassemblyFlavor == _T(&quot;set disassembly-flavor or32&quot;)) blabla
<span class="gd">-static wxRegEx reDisassemblyInitFuncOR32(_T(&quot;PC = (0x[A-Fa-f0-9]+) in ([^;]*)&quot;));</span>
<span class="gi">+static wxRegEx reDisassemblyInitFuncOR32_MIPS(_T(&quot;PC = (0x[A-Fa-f0-9]+) in ([^;]*)&quot;));</span>
 #endif
 //    Using the running image of child Thread 46912568064384 (LWP 7051).
 static wxRegEx reInfoProgramThread(_T(&quot;\\(LWP[ \t]([0-9]+)\\)&quot;));
<span class="gu">@@ -1135,6 +1135,11 @@</span>
             {
                 ParseOutputFromOR32gdbPort(output);
             }
<span class="gi">+            // MIPS register string parser</span>
<span class="gi">+            if(m_disassemblyFlavor == _T(&quot;set disassembly-flavor mips&quot;))</span>
<span class="gi">+            {</span>
<span class="gi">+                ParseOutputFromMIPSgdbPort(output);</span>
<span class="gi">+            }</span>
             else
             // use generic parser - this may work for other platforms or you may have to write your own
             {
<span class="gu">@@ -1153,6 +1158,77 @@</span>
 //            m_pDriver-&gt;DebugLog(output);
         }
 
<span class="gi">+        void ParseOutputFromMIPSgdb</span>
<em><strong>file truncated...</strong></em>
</pre></div>

      <h4 class="page-header">History</h4>
      <div class="panel panel-default">
        <div class="panel-heading">nevelo 2011-12-11 15:34</div>
        <div class="panel-body">
          <p>Hi,</p>
          <p>I added support for MIPS GDB debugging which is pretty similar to what was already there for OR32.</p>
          <p>I also added the option to specify an external tool to be run on requesting debugger break from execution (DebuggerGDB::Break).</p>
          <p>Some embedded setups need specific handling to break from execution (well mine does and I've seen forum posts to indicate that others also might benefit from this).</p>
          <p>[Only added in for Win32 for the moment]</p>
          <p>With these changes I know have a perfectly function debugger for MIPs via GDB in Code::Blocks :-)</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">tpetrov 2011-12-19 02:12</div>
        <div class="panel-body">
          <p>Hi,</p>
          <p>Unfortunately all debugger development happens in the wxpropgrid_debugger branch and the branch is quite different to trunk already, so your patch won't apply.</p>
          <p>Can I ask you to modify it to apply on the branch?</p>
          <p>Also can you separate in two different patches the MIPS support and the external tool break support?</p>
        </div>
      </div>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
  </body>
</html>