<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Patch 1125 - Code::Blocks History</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="../pygments.css">
  </head>
  <body role="document">
    <div class="navbar navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://www.codeblocks.org/">Code::Blocks</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../index.html">Home</a></li>
            <li><a href="../bugs.html">Bugs</a></li>
            <li><a href="../features.html">Features</a></li>
            <li class="active"><a href="../patches.html">Patches</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container" role="main">
      <div class="row">
        <div class="col-sm-8">
          <h3>Patch #1125 <small>2006-06-12 18:10</small></h3>
          <h4>kkez</h4>
          Replace in files
          <dl class="dl-horizontal">
            <dt>Download</dt>
            <dd><a href="1125-Replace_in_fil.patch">1125-Replace_in_fil.patch</a> (54.1 KB)</dd>
          </dl>
        </div>
        <div class="col-sm-4">
          <dl class="dl-horizontal">
            <dt>Category</dt><dd>Plugin::FeatureAdd</dd>
            <dt>Status</dt><dd>Accepted</dd>
            <dt>Close date</dt><dd>2006-06-14 11:11 <a href="http://cb.biplab.in/websvn/log.php?sr=2565"><span class="glyphicon glyphicon-link"></span></a></dd>
            <dt>Assigned to</dt><dd>&nbsp;</dd>
          </dl>
        </div>
      </div>
      <div class="highlight"><pre class="pre-scrollable"><span class="gh">Index: src/sdk/confirmreplacedlg.cpp</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/sdk/confirmreplacedlg.cpp    (revision 2551)</span>
<span class="gi">+++ src/sdk/confirmreplacedlg.cpp    (working copy)</span>
<span class="gu">@@ -34,15 +34,20 @@</span>
 #include &quot;confirmreplacedlg.h&quot;
 
 BEGIN_EVENT_TABLE(ConfirmReplaceDlg, wxDialog)
<span class="gd">-    EVT_BUTTON(XRCID(&quot;btnYes&quot;),     ConfirmReplaceDlg::OnYes)</span>
<span class="gd">-    EVT_BUTTON(XRCID(&quot;btnNo&quot;),         ConfirmReplaceDlg::OnNo)</span>
<span class="gd">-    EVT_BUTTON(XRCID(&quot;btnAll&quot;),     ConfirmReplaceDlg::OnAll)</span>
<span class="gd">-    EVT_BUTTON(XRCID(&quot;btnCancel&quot;),    ConfirmReplaceDlg::OnCancel)</span>
<span class="gi">+    EVT_BUTTON(XRCID(&quot;btnYes&quot;),         ConfirmReplaceDlg::OnYes)</span>
<span class="gi">+    EVT_BUTTON(XRCID(&quot;btnNo&quot;),             ConfirmReplaceDlg::OnNo)</span>
<span class="gi">+    EVT_BUTTON(XRCID(&quot;btnAllInFile&quot;),   ConfirmReplaceDlg::OnAllInFile)</span>
<span class="gi">+    EVT_BUTTON(XRCID(&quot;btnSkipFile&quot;),    ConfirmReplaceDlg::OnSkipFile)</span>
<span class="gi">+    EVT_BUTTON(XRCID(&quot;btnAll&quot;),         ConfirmReplaceDlg::OnAll)</span>
<span class="gi">+    EVT_BUTTON(XRCID(&quot;btnCancel&quot;),        ConfirmReplaceDlg::OnCancel)</span>
 END_EVENT_TABLE()
 
<span class="gd">-ConfirmReplaceDlg::ConfirmReplaceDlg(wxWindow* parent, const wxString&amp; label)</span>
<span class="gi">+ConfirmReplaceDlg::ConfirmReplaceDlg(wxWindow* parent, bool replaceInFiles, const wxString&amp; label)</span>
 {
<span class="gd">-    wxXmlResource::Get()-&gt;LoadDialog(this, parent, _T(&quot;dlgConfirmReplace&quot;));</span>
<span class="gi">+    if (replaceInFiles)</span>
<span class="gi">+        wxXmlResource::Get()-&gt;LoadDialog(this, parent, _T(&quot;dlgConfirmReplaceMultiple&quot;));</span>
<span class="gi">+    else</span>
<span class="gi">+        wxXmlResource::Get()-&gt;LoadDialog(this, parent, _T(&quot;dlgConfirmReplace&quot;));</span>
     XRCCTRL(*this, &quot;lblMessage&quot;, wxStaticText)-&gt;SetLabel(label);
 }
 
<span class="gu">@@ -60,6 +65,16 @@</span>
     EndModal(crNo);
 }
 
<span class="gi">+void ConfirmReplaceDlg::OnAllInFile(wxCommandEvent&amp; event)</span>
<span class="gi">+{</span>
<span class="gi">+    EndModal(crAllInFile);</span>
<span class="gi">+}</span>
<span class="gi">+</span>
<span class="gi">+void ConfirmReplaceDlg::OnSkipFile(wxCommandEvent&amp; event)</span>
<span class="gi">+{</span>
<span class="gi">+    EndModal(crSkipFile);</span>
<span class="gi">+}</span>
<span class="gi">+</span>
 void ConfirmReplaceDlg::OnAll(wxCommandEvent&amp; event)
 {
     EndModal(crAll);
<span class="gh">Index: src/sdk/confirmreplacedlg.h</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/sdk/confirmreplacedlg.h    (revision 2551)</span>
<span class="gi">+++ src/sdk/confirmreplacedlg.h    (working copy)</span>
<span class="gu">@@ -10,6 +10,8 @@</span>
 {
     crYes = 0,
     crNo,
<span class="gi">+    crAllInFile,</span>
<span class="gi">+    crSkipFile,</span>
     crAll,
     crCancel
 };
<span class="gu">@@ -17,10 +19,13 @@</span>
 class ConfirmReplaceDlg : public wxDialog
 {
     public:
<span class="gd">-        ConfirmReplaceDlg(wxWindow* parent, const wxString&amp; label = _(&quot;Replace this occurence?&quot;));</span>
<span class="gi">+        ConfirmReplaceDlg(wxWindow* parent, bool replaceInFiles = false, </span>
<span class="gi">+            const wxString&amp; label = _(&quot;Replace this occurrence?&quot;));</span>
         ~ConfirmReplaceDlg();
         void OnYes(wxCommandEvent&amp; event);
         void OnNo(wxCommandEvent&amp; event);
<span class="gi">+        void OnAllInFile(wxCommandEvent&amp; event);</span>
<span class="gi">+        void OnSkipFile(wxCommandEvent&amp; event);</span>
         void OnAll(wxCommandEvent&amp; event);
         void OnCancel(wxCommandEvent&amp; event);
         void CalcPosition(cbStyledTextCtrl* ed);
<span class="gh">Index: src/sdk/editormanager.cpp</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/sdk/editormanager.cpp    (revision 2551)</span>
<span class="gi">+++ src/sdk/editormanager.cpp    (working copy)</span>
<span class="gu">@@ -951,7 +951,7 @@</span>
                 wxString msg;
                 msg.Printf(_(&quot;File %s is modified outside the IDE...\nDo you want to reload it (you will lose any unsaved work)?&quot;),
                            ed-&gt;GetFilename().c_str());
<span class="gd">-                ConfirmReplaceDlg dlg(Manager::Get()-&gt;GetAppWindow(), msg);</span>
<span class="gi">+                ConfirmReplaceDlg dlg(Manager::Get()-&gt;GetAppWindow(), false, msg);</span>
                 dlg.SetTitle(_(&quot;Reload file?&quot;));
                 PlaceWindow(&amp;dlg);
                 ret = dlg.ShowModal();
<span class="gu">@@ -1161,7 +1161,7 @@</span>
     if (!replace)
         dlg = new FindDlg(Manager::Get()-&gt;GetAppWindow(), phraseAtCursor, hasSelection, !ed, explicitly_find_in_files);
     else
<span class="gd">-        dlg = new ReplaceDlg(Manager::Get()-&gt;GetAppWindow(), phraseAtCursor, hasSelection);</span>
<span class="gi">+        dlg = new ReplaceDlg(Manager::Get()-&gt;GetAppWindow(), phraseAtCursor, hasSelection, !ed, explicitly_find_in_files);</span>
 
     PlaceWindow(dlg);
     if (dlg-&gt;ShowModal() == wxID_CANCEL)
<span class="gu">@@ -1205,23 +1205,26 @@</span>
     if (!replace)
     {
         if (m_LastFindReplaceData-&gt;findInFiles)
<span class="gd">-        {</span>
<span class="gd">-            int ans = FindInFiles(m_LastFindReplaceData);</span>
<span class="gd">-            // FindInFiles() is done, default back to Find in Editor</span>
<span class="gd">-            m_LastFindReplaceData-&gt;findInFiles = false;</span>
<span class="gd">-            return ans;</span>
<span class="gd">-        }</span>
<span class="gi">+            return FindInFiles(m_LastFindReplaceData);</span>
         else
             return Find(control, m_LastFindReplaceData);
     }
     else
     {
         m_LastFindReplaceData-&gt;initialreplacing = true;
<span class="gd">-        return Replace(control, m_LastFindReplaceData);</span>
<span class="gi">+        </span>
<span class="gi">+        if (m_LastFindReplaceData-&gt;findInFiles)</span>
<span class="gi">+            return ReplaceInFiles(m_LastFindReplaceData);</span>
<span class="gi">+        else</span>
<span class="gi">+            return Replace(control, m_LastFindReplaceData);</span>
     }
<span class="gi">+    </span>
<span class="gi">+    //Default back to find or replace in Editor</span>
<span class="gi">+    if(m_LastFindReplaceData-&gt;findInFiles)</span>
<span class="gi">+        m_LastFindReplaceData-&gt;findInFiles = false;</span>
 }
 
<span class="gd">-v</span>
<em><strong>download for full patch...</strong></em>
</pre></div>

      <h4 class="page-header">History</h4>
      <div class="panel panel-default">
        <div class="panel-heading">kkez 2006-06-12 18:26</div>
        <div class="panel-body">
          <p>It adds and modify:</p>
          <p>1) search menu item "Replace in files" under "Replace"</p>
          <p>2) another confirmation dialog with more option ("replace all occurrence in a file" and "skip a file"), so another .xrc and another class under confirmreplacedlg.cpp/.h</p>
          <p>3) the .xrc of the replace dialog, modified with notebook and "replace in files" panel; modified replacedlg.cpp/.h to handle both panels</p>
          <p>4) the "replace in files" function</p>
          <p>5) added the CodeBlocks.cbp file too since i've added a .xrc file.</p>
          <p>6) fixed a little typo in the confirm_replace.xrc (occurence)</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">kkez 2006-06-13 08:52</div>
        <div class="panel-body">
          <p>This patch was breaking the "Find in files" feature, because i was setting the data-&gt;start variable to 0 instead of the return value of GetCurrentPos(). But this shouldn't happen, because the "Find in files" search should search in the entire scope and don't do any wrap around.</p>
          <p>Both Replace and Find does the wrap around, but FindInFiles shouldn't use the Find function since it wraps around, but use its own algoritm, just like i did in the ReplaceInFiles function.</p>
          <p>By now i just added a bool to the CalculateFindReplaceStartEnd() function to set data-&gt;start to 0 when ReplaceInFiles, or GetCurrentPos() in any other case.</p>
          <p>I've also splitted the patch to make it more readable. The CodeBlocks.cbp path now it's in this file:</p>
          <p>The other part is the one i'm submitting now.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">kkez 2006-06-13 08:54</div>
        <div class="panel-body">
          <p>Uh, forgot to add the patch part 1 link: <a href="http://www.winapizone.net/replaceinfiles.part1.patch">http://www.winapizone.net/replaceinfiles.part1.patch</a></p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">kkez 2006-06-13 09:45</div>
        <div class="panel-body">
          <p>I've now removed the ConfirmReplaceMultipleDlg class and merged the new buttons events with the existing ConfirmReplaceDlg class. Sorry for all these updates :)</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">kkez 2006-06-13 10:38</div>
        <div class="panel-body">
          <p>Another update :)</p>
          <p>I forgot to add the new xrc file and the "reload file" dialog now uses the correct "confirm replace" dialog. I don't quite understand the implicit conversion between the wxString "File has changed from the last..." and the bool in the ConfirmReplace constructor. Luckily i've spotted it immediately :)</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">kkez 2006-06-13 16:08</div>
        <div class="panel-body">
          <p>Now i close the file when no replacements took place only if i opened the file in the editor (because it wasn't already open), and i replaced the loop to check if the file is already open with IsOpen. Now this patch should really be ok.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">mandrav 2006-06-14 11:11</div>
        <div class="panel-body">
          <p>Thanks for the patch.</p>
          <p>I still had to fix/improve some things but it's nice that you provided the base code :)</p>
        </div>
      </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
  </body>
</html>
