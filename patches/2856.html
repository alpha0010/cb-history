<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Patch 2856 - Code::Blocks History</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">

    <link rel="stylesheet" href="../pygments.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="navbar navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://www.codeblocks.org/">Code::Blocks</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../index.html">Home</a></li>
            <li><a href="../bugs.html">Bugs</a></li>
            <li><a href="../features.html">Features</a></li>
            <li class="active"><a href="../patches.html">Patches</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container" role="main">
      <div class="row">
        <div class="col-sm-8">
          <h3>Patch #2856 <small>2009-12-08 16:44:07</small></h3>
          <h4>techy</h4>
          parserthread accesses memory behind the end of the string
          <dl class="dl-horizontal">
            <dt>Download</dt>
            <dd><a href="2856-parserthread_a.patch">2856-parserthread_a.patch</a></dd>
          </dl>
        </div>
        <div class="col-sm-4">
          <dl class="dl-horizontal">
            <dt>Category</dt><dd>Plugin::Bugfix</dd>
            <dt>Status</dt><dd>Accepted</dd>
            <dt>Close date</dt><dd>2009-12-31 14:42:33</dd>
            <dt>Assigned to</dt><dd>mortenmacfly</dd>
          </dl>
        </div>
      </div>
      <div class="highlight"><pre class="pre-scrollable"><span class="gh">Index: src/plugins/codecompletion/parser/parserthread.cpp</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/plugins/codecompletion/parser/parserthread.cpp    (revision 5964)</span>
<span class="gi">+++ src/plugins/codecompletion/parser/parserthread.cpp    (working copy)</span>
<span class="gu">@@ -895,9 +895,9 @@</span>
                     str += *ptr;
                     //find end
                     int n = 0;
<span class="gi">+                    ptr++;</span>
                     while(*ptr != _T(&#39;\0&#39;))
                     {
<span class="gd">-                        ptr++;</span>
                         if (*ptr == _T(&#39;(&#39;))
                             n++;
                         else if (*ptr == _T(&#39;)&#39;))
<span class="gu">@@ -912,6 +912,7 @@</span>
                             skip = false;
                             break;
                         }
<span class="gi">+                        ptr++;</span>
                     }
                 }
             }
<span class="gu">@@ -925,7 +926,7 @@</span>
             {
                 if (*ptr != _T(&#39; &#39;))
                     str += *ptr;
<span class="gd">-                *ptr++;</span>
<span class="gi">+                ptr++;</span>
             }
             skip = true;
             sym  = true;
<span class="gu">@@ -935,7 +936,7 @@</span>
             {
                 if (*ptr != _T(&#39; &#39;))
                     str += *ptr;
<span class="gd">-                *ptr++;</span>
<span class="gi">+                ptr++;</span>
             }
             skip = true;
             sym  = true;
<span class="gu">@@ -950,19 +951,23 @@</span>
         default:
             sym = false;
         }
<span class="gi">+        </span>
         if (!skip || sym)
         {
<span class="gd">-            str += *ptr;</span>
<span class="gi">+            if (*ptr != _T(&#39;\0&#39;))</span>
<span class="gi">+                str += *ptr;</span>
             if (wxIsalnum(*ptr))
                 word += *ptr;
         }
 
<span class="gd">-        if (sym == true &amp;&amp; skip == false)</span>
<span class="gi">+        if (sym &amp;&amp; !skip)</span>
         {
             while (*ptr != _T(&#39;\0&#39;) &amp;&amp; *(ptr+1) == _T(&#39; &#39;))
                 ptr++;
         }
<span class="gd">-        ptr++;</span>
<span class="gi">+        </span>
<span class="gi">+        if (*ptr != _T(&#39;\0&#39;))</span>
<span class="gi">+            ptr++;</span>
     }
 
     return str;
</pre></div>

      <h4 class="page-header">History</h4>
      <div class="panel panel-default">
        <div class="panel-heading">techy 2009-12-08 16:51:39</div>
        <div class="panel-body">
          <p>In GetRealArgs() there are several places where the parser can skip the final '\0' and continue reading behind it. This lead to segfault on my machine at least once. I've fixed this (plus made some cosmetic changes where I could not resist).</p>
          <p>This patch fixes _only_ the memory problems - after looking at the code briefly, I'm not quite convinced that it does the right thing, but I may be wrong. There is another crasher on my system when I click something in the symbols browser, which could also be related. If I have time, I'll look into this but as I don't use symbols browser normally, this is low priority for me.</p>
        </div>
      </div>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
  </body>
</html>