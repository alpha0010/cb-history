<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Patch 2877 - Code::Blocks History</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">

    <link rel="stylesheet" href="../pygments.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="navbar navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://www.codeblocks.org/">Code::Blocks</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../index.html">Home</a></li>
            <li><a href="../bugs.html">Bugs</a></li>
            <li><a href="../features.html">Features</a></li>
            <li class="active"><a href="../patches.html">Patches</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container" role="main">
      <div class="row">
        <div class="col-sm-8">
          <h3>Patch #2877 <small>2009-12-27 18:53</small></h3>
          <h4>techy</h4>
          CompilerOptionsDlg acesses tabs that don't exist (debug5)
          <dl class="dl-horizontal">
            <dt>Download</dt>
            <dd><a href="2877-CompilerOption.patch">2877-CompilerOption.patch</a> (9.2 KB)</dd>
          </dl>
        </div>
        <div class="col-sm-4">
          <dl class="dl-horizontal">
            <dt>Category</dt><dd>Application::Bugfix</dd>
            <dt>Status</dt><dd>Accepted</dd>
            <dt>Close date</dt><dd>2010-01-14 08:16 <a href="http://cb.biplab.in/websvn/log.php?sr=6085"><span class="glyphicon glyphicon-link"></span></a></dd>
            <dt>Assigned to</dt><dd>mortenmacfly</dd>
          </dl>
        </div>
      </div>
      <div class="highlight"><pre class="pre-scrollable"><span class="gh">Index: src/plugins/compilergcc/compileroptionsdlg.cpp</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/plugins/compilergcc/compileroptionsdlg.cpp    (revision 5986)</span>
<span class="gi">+++ src/plugins/compilergcc/compileroptionsdlg.cpp    (working copy)</span>
<span class="gu">@@ -474,6 +474,9 @@</span>
 
 void CompilerOptionsDlg::DoFillOthers()
 {
<span class="gi">+    if (m_pProject)</span>
<span class="gi">+        return; // projects don&#39;t have Other tab</span>
<span class="gi">+        </span>
     wxCheckBox* chk = XRCCTRL(*this, &quot;chkIncludeFileCwd&quot;, wxCheckBox);
     if (chk)
         chk-&gt;SetValue(Manager::Get()-&gt;GetConfigManager(_T(&quot;compiler&quot;))-&gt;ReadBool(_T(&quot;/include_file_cwd&quot;), false));
<span class="gu">@@ -825,7 +828,7 @@</span>
     ArrayString2TextCtrl(m_LinkerOptions, XRCCTRL(*this, &quot;txtLinkerOptions&quot;, wxTextCtrl));
 
     // only if &quot;Commands&quot; page exists
<span class="gd">-    if (XRCCTRL(*this, &quot;txtCmdBefore&quot;, wxTextCtrl))</span>
<span class="gi">+    if (m_pProject)</span>
     {
         ArrayString2TextCtrl(CommandsBeforeBuild, XRCCTRL(*this, &quot;txtCmdBefore&quot;, wxTextCtrl));
         ArrayString2TextCtrl(CommandsAfterBuild, XRCCTRL(*this, &quot;txtCmdAfter&quot;, wxTextCtrl));
<span class="gu">@@ -927,7 +930,7 @@</span>
         wxArrayString CommandsBeforeBuild;
         wxArrayString CommandsAfterBuild;
         bool AlwaysUsePost = false;
<span class="gd">-        if (XRCCTRL(*this, &quot;txtCmdBefore&quot;, wxTextCtrl))</span>
<span class="gi">+        if (m_pProject)</span>
         {
             AlwaysUsePost = XRCCTRL(*this, &quot;chkAlwaysRunPost&quot;, wxCheckBox)-&gt;GetValue();
             DoGetCompileOptions(CommandsBeforeBuild, XRCCTRL(*this, &quot;txtCmdBefore&quot;, wxTextCtrl));
<span class="gu">@@ -2169,9 +2172,9 @@</span>
         XRCCTRL(*this, &quot;btnCopyLibs&quot;, wxButton)-&gt;Enable(lstLibs-&gt;GetCount() != 0);
         XRCCTRL(*this, &quot;spnLibs&quot;,     wxSpinButton)-&gt;Enable(en);
     }
<span class="gd">-</span>
<span class="gi">+    </span>
     // edit/delete/clear/copy/moveup/movedown extra path
<span class="gd">-    if (XRCCTRL(*this, &quot;lstExtraPaths&quot;, wxListBox))</span>
<span class="gi">+    if (!m_pProject)</span>
     {
         en = XRCCTRL(*this, &quot;lstExtraPaths&quot;, wxListBox)-&gt;GetSelection() &gt;= 0;
         XRCCTRL(*this, &quot;btnExtraEdit&quot;,   wxButton)-&gt;Enable(en);
<span class="gu">@@ -2180,13 +2183,10 @@</span>
     }
 
     // add/edit/delete/clear vars
<span class="gd">-    if (XRCCTRL(*this, &quot;lstVars&quot;, wxListBox))</span>
<span class="gd">-    {</span>
<span class="gd">-        en = XRCCTRL(*this, &quot;lstVars&quot;, wxListBox)-&gt;GetSelection() &gt;= 0;</span>
<span class="gd">-        XRCCTRL(*this, &quot;btnEditVar&quot;,   wxButton)-&gt;Enable(en);</span>
<span class="gd">-        XRCCTRL(*this, &quot;btnDeleteVar&quot;, wxButton)-&gt;Enable(en);</span>
<span class="gd">-        XRCCTRL(*this, &quot;btnClearVar&quot;,  wxButton)-&gt;Enable(XRCCTRL(*this, &quot;lstVars&quot;, wxListBox)-&gt;GetCount() != 0);</span>
<span class="gd">-    }</span>
<span class="gi">+    en = XRCCTRL(*this, &quot;lstVars&quot;, wxListBox)-&gt;GetSelection() &gt;= 0;</span>
<span class="gi">+    XRCCTRL(*this, &quot;btnEditVar&quot;,   wxButton)-&gt;Enable(en);</span>
<span class="gi">+    XRCCTRL(*this, &quot;btnDeleteVar&quot;, wxButton)-&gt;Enable(en);</span>
<span class="gi">+    XRCCTRL(*this, &quot;btnClearVar&quot;,  wxButton)-&gt;Enable(XRCCTRL(*this, &quot;lstVars&quot;, wxListBox)-&gt;GetCount() != 0);</span>
 
     // policies
     wxTreeCtrl* tc = XRCCTRL(*this, &quot;tcScope&quot;, wxTreeCtrl);
<span class="gu">@@ -2199,7 +2199,7 @@</span>
     XRCCTRL(*this, &quot;cmbResDirsPolicy&quot;,  wxChoice)-&gt;Enable(en);
 
     // compiler set buttons
<span class="gd">-    if (XRCCTRL(*this, &quot;btnAddCompiler&quot;, wxButton)) // only if exist</span>
<span class="gi">+    if (!m_pProject) </span>
     {
         en = !data; // global options selected
         int idx   = XRCCTRL(*this, &quot;cmbCompiler&quot;, wxChoice)-&gt;GetSelection();
<span class="gu">@@ -2215,21 +2215,9 @@</span>
         XRCCTRL(*this, &quot;btnResetCompiler&quot;,      wxButton)-&gt;Enable(en &amp;&amp;
                                                                   compiler &amp;&amp;
                                                                   compiler-&gt;GetParentID().IsEmpty());
<span class="gd">-    }</span>
 
<span class="gd">-    // &quot;others&quot; tab</span>
<span class="gd">-    if (XRCCTRL(*this, &quot;chkSaveHtmlLog&quot;, wxCheckBox)) // page exists?</span>
<span class="gd">-    {</span>
         XRCCTRL(*this, &quot;chkFullHtmlLog&quot;, wxCheckBox)-&gt;Enable(XRCCTRL(*this, &quot;chkSaveHtmlLog&quot;, wxCheckBox)-&gt;IsChecked());
<span class="gd">-    }</span>
<span class="gd">-    if (   XRCCTRL(*this, &quot;lstIgnore&quot;,       wxListBox)</span>
<span class="gd">-        &amp;&amp; XRCCTRL(*this, &quot;btnIgnoreRemove&quot;, wxButton) ) // page exists?</span>
<span class="gd">-    {</span>
         XRCCTRL(*this, &quot;btnIgnoreRemove&quot;, wxButton)-&gt;Enable(XRCCTRL(*this, &quot;lstIgnore&quot;, wxListBox)-&gt;GetCount()&gt;0);
<span class="gd">-    }</span>
<span class="gd">-    if (   XRCCTRL(*this, &quot;txtIgnore&quot;,    wxTextCtrl)</span>
<span class="gd">-        &amp;&amp; XRCCTRL(*this, &quot;btnIgnoreAdd&quot;, wxButton) ) // page exists?</span>
<span class="gd">-    {</span>
         XRCCTRL(*this, &quot;btnIgnoreAdd&quot;, wxButton)-&gt;Enable(XRCCTRL(*this, &quot;txtIgnore&quot;, wxTextCtrl)-&gt;GetValue().Trim().Len()&gt;0);
     }
 } // OnUpdateUI
<span class="gu">@@ -2240,57 +2228,60 @@</span>
     DoSaveCompilerDependentSettings();
     CompilerFactory::SaveSettings();
 
<span class="gd">-    //others</span>
<span class="gd">-    wxCheckBox* chk = XRCCTRL(*this, &quot;chkIncludeFileCwd&quot;, wxCheckBox);</span>
<span class="gd">-    if (chk)</span>
<span class="gd">-        Manager::Get()-&gt;GetConfigManager(_T(&quot;compiler&quot;))-&gt;Write(_T(&quot;/include_file_cwd&quot;), (bool)chk-&gt;IsChecked());</span>
<span class="gd">-    chk = XRCCTRL(*this, &quot;chkIncludePrjCwd&quot;, wxCheckBox);</span>
<span class="gd">-    if (chk)</span>
<span class="gd">-        Manager::Get()-&gt;GetConfigManager(_T(&quot;compiler&quot;))-&gt;Write(_T(&quot;/include_prj_cwd&quot;), (bool)chk-&gt;IsChecked());</span>
<span class="gd">-    chk = XRCCTRL(*this, &quot;chkSaveHtmlLog&quot;, wxCheckBox);</span>
<span class="gd">-    if (chk)</span>
<span class="gd">-        Manager::Get()-&gt;GetConfigManager(_T(&quot;compiler&quot;))-&gt;Write(_T(&quot;/save_html_build_log&quot;), (bool)chk-&gt;IsChecked());</span>
<span class="gd">-    chk = XRCCTRL(*this, &quot;chkFullHtmlLog&quot;, wxCheckBox);</span>
<span class="gd">-    if (chk)</span>
<span class="gd">-        Manager::Get()-&gt;GetConfigManager(_T(&quot;compiler&quot;))-&gt;Write(_T(&quot;/save_html_bu</span>
<em><strong>file truncated...</strong></em>
</pre></div>

      <h4 class="page-header">History</h4>
      <div class="panel panel-default">
        <div class="panel-heading">techy 2009-12-27 18:53</div>
        <div class="panel-body">
          <p>CompilerOptionsDlg is used in three situations - 1. global options, 2. project options, 3. target options. Depending on its use, some tabs are deleted in the constructor. This patch makes sure that objects from the non-existing tabs are not accessed in the rest of the code.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">mortenmacfly 2009-12-28 19:33</div>
        <div class="panel-body">
          <p>I don't really get whats wrong with trying to obtain the control instead of verifying a project is present. What if we change the possibilities to set in case (absense) of a project? I am not sure about this one...</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">techy 2009-12-28 23:37</div>
        <div class="panel-body">
          <p>The problem here is that XRCCTRL goes through the existing wxObjects and tries to find the object with the given id. If it doesn't find one, it raises an assertion (useful for instance if you called XRCCTRL on something you haven't loaded yet with wxXmlResource::Get()-&gt;LoadPanel() ). Because DeletePage() really physically deletes all the objects present in he page, you get the assertion here as well because these objects cannot be found in memory. From what I have seen, you don't even have guaranteed that you get NULL when the resource is not found:</p>
          <p>// This macro returns pointer to particular control in dialog</p>
          <p>// created using XML resources. You can use it to set/get values from</p>
          <p>// controls.</p>
          <p>// Example:</p>
          <p>//    wxDialog dlg;</p>
          <p>//    wxXmlResource::Get()-&gt;LoadDialog(&amp;dlg, mainFrame, "my_dialog");</p>
          <p>//    XRCCTRL(dlg, "my_textctrl", wxTextCtrl)-&gt;SetValue(wxT("default value"));</p>
          <p>#define XRCCTRL(window, id, type) \</p>
          <p>(wxStaticCast((window).FindWindow(XRCID(id)), type))</p>
          <p>An alternative solution would be to use some flags (initialized in constructor) determining the presence of a tab and have code like</p>
          <p>if (m_thisPageIsPresent) {</p>
          <p>//do this</p>
          <p>}</p>
          <p>if (m_thatPageIsPresent) {</p>
          <p>//do that</p>
          <p>}</p>
        </div>
      </div>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
  </body>
</html>