<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Patch 985 - Code::Blocks History</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">

    <link rel="stylesheet" href="../pygments.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="navbar navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://www.codeblocks.org/">Code::Blocks</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../index.html">Home</a></li>
            <li><a href="../bugs.html">Bugs</a></li>
            <li><a href="../features.html">Features</a></li>
            <li class="active"><a href="../patches.html">Patches</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container" role="main">
      <div class="row">
        <div class="col-sm-8">
          <h3>Patch #985 <small>2006-04-08 18:12</small></h3>
          <h4>dermeister</h4>
          <a href="../features/2119.html" data-toggle="tooltip" title="swap header/source enhancement">Feature Request #2119</a> (swap header/source enchancement)
          <dl class="dl-horizontal">
            <dt>Download</dt>
            <dd><a href="985-Feature_Request.patch">985-Feature_Request.patch</a> (2.7 KB)</dd>
          </dl>
        </div>
        <div class="col-sm-4">
          <dl class="dl-horizontal">
            <dt>Category</dt><dd>Application::FeatureAdd</dd>
            <dt>Status</dt><dd>Accepted</dd>
            <dt>Close date</dt><dd>2006-05-09 10:41 <a href="http://cb.biplab.in/websvn/log.php?sr=2438"><span class="glyphicon glyphicon-link"></span></a></dd>
            <dt>Assigned to</dt><dd>&nbsp;</dd>
          </dl>
        </div>
      </div>
      <div class="highlight"><pre class="pre-scrollable"><span class="gh">Index: src/sdk/editormanager.cpp</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/sdk/editormanager.cpp    (revision 2321)</span>
<span class="gi">+++ src/sdk/editormanager.cpp    (working copy)</span>
<span class="gu">@@ -585,12 +585,12 @@</span>
     }
 }
 
<span class="gd">-cbEditor* EditorManager::New()</span>
<span class="gi">+cbEditor* EditorManager::New(const wxString&amp; newFileName)</span>
 {
     SANITY_CHECK(0L);
 
     wxString old_title = Manager::Get()-&gt;GetAppWindow()-&gt;GetTitle(); // Fix for Bug #1389450
<span class="gd">-    cbEditor* ed = new cbEditor(m_pNotebook, wxEmptyString);</span>
<span class="gi">+    cbEditor* ed = new cbEditor(m_pNotebook, newFileName);</span>
     if (!ed-&gt;SaveAs())
     {
         //DeletePage(ed-&gt;GetPageIndex());
<span class="gu">@@ -1104,6 +1104,41 @@</span>
         //    newEd-&gt;SetProjectFile(ed-&gt;GetProjectFile());
         return newEd;
     }
<span class="gi">+</span>
<span class="gi">+    // We couldn&#39;t find the file, maybe it does not exist. Ask the user if we</span>
<span class="gi">+    // should create it:</span>
<span class="gi">+    if (cbMessageBox(_(&quot;The file does not exist. Do you want to create it?&quot;),</span>
<span class="gi">+                _(&quot;Error&quot;), wxICON_QUESTION | wxYES_NO) == wxID_YES)</span>
<span class="gi">+    {</span>
<span class="gi">+        cbProject* project = Manager::Get()-&gt;GetProjectManager()-&gt;GetActiveProject();</span>
<span class="gi">+        if (project)</span>
<span class="gi">+            wxSetWorkingDirectory(project-&gt;GetBasePath());</span>
<span class="gi">+</span>
<span class="gi">+        // Create a suggestion for the new file name:</span>
<span class="gi">+        if (ft == ftHeader)</span>
<span class="gi">+            fn.SetExt(FileFilters::CPP_EXT);</span>
<span class="gi">+        else if (ft == ftSource)</span>
<span class="gi">+            fn.SetExt(FileFilters::H_EXT);</span>
<span class="gi">+        // else? Well, if the filename is not changed we could possibly</span>
<span class="gi">+        // overwrite an existing file with our suggestion.</span>
<span class="gi">+</span>
<span class="gi">+        cbEditor* newEd = New(fn.GetFullPath());</span>
<span class="gi">+        if (cbMessageBox(_(&quot;Do you want to add this new file in the active project?&quot;),</span>
<span class="gi">+                    _(&quot;Add file to project&quot;),</span>
<span class="gi">+                    wxYES_NO | wxICON_QUESTION) == wxID_YES)</span>
<span class="gi">+        {</span>
<span class="gi">+            wxArrayInt targets;</span>
<span class="gi">+            if (Manager::Get()-&gt;GetProjectManager()-&gt;AddFileToProject(newEd-&gt;GetFilename(), project, targets) != 0)</span>
<span class="gi">+            {</span>
<span class="gi">+                ProjectFile* pf = project-&gt;GetFileByFilename(newEd-&gt;GetFilename(), false);</span>
<span class="gi">+                newEd-&gt;SetProjectFile(pf);</span>
<span class="gi">+                Manager::Get()-&gt;GetProjectManager()-&gt;RebuildTree();</span>
<span class="gi">+            }</span>
<span class="gi">+        }</span>
<span class="gi">+        // verify that the open files are still in sync</span>
<span class="gi">+        // the new file might have overwritten an existing one)</span>
<span class="gi">+        Manager::Get()-&gt;GetEditorManager()-&gt;CheckForExternallyModifiedFiles();</span>
<span class="gi">+    }</span>
     return 0L;
 }
 
<span class="gh">Index: src/sdk/editormanager.h</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/sdk/editormanager.h    (revision 2321)</span>
<span class="gi">+++ src/sdk/editormanager.h    (working copy)</span>
<span class="gu">@@ -72,7 +72,7 @@</span>
         void SetActiveEditor(EditorBase* ed);
         EditorColorSet* GetColorSet(){ return (this==NULL) ? 0 : m_Theme; }
         void SetColorSet(EditorColorSet* theme);
<span class="gd">-        cbEditor* New();</span>
<span class="gi">+        cbEditor* New(const wxString&amp; newFileName = wxEmptyString);</span>
 
         // these are used *only* for custom editors
         void AddCustomEditor(EditorBase* eb);
</pre></div>

      <h4 class="page-header">History</h4>
      <div class="panel panel-default">
        <div class="panel-heading">mandrav 2006-04-10 09:27</div>
        <div class="panel-body">
          <p>I don't get it...</p>
          <p>What does this have to do with ftr.req. 2119?</p>
          <p>This just adds a parameter in EditorManager::New().</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">dermeister 2006-04-10 10:33</div>
        <div class="panel-body">
          <p>If you edit a .cpp-file and click on 'swap header/source' but the headerfile does not exist, nothing happens. This is the behaviour of Code::Blocks. But (as requested in ftr. req. 2119) it would probably better to ask the user if he wants to create this missing file (as he wants to access it he either assumes that it is there or at least he wants it to be there). This patch implements exactly this. If the file cannot be found it asks the user if he wants to create a new file. I manily used the code the is executed by clicking 'File-&gt;New' to get this, thus the behaviour is the same.</p>
          <p>I only made one change: Normaly the suggested filename for a new file is 'Untitled'. Thats OK but in this case we could give a better suggestion: The file that we were looking for. To achive this I added this parameter to EditorManager::New(). This doens't really change the interface of EditorManager because this parameter is optional and if you don't provide it you get exactly the old behaviour.</p>
        </div>
      </div>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script>
      $(document).ready(function() {
        $("body").tooltip({ selector: '[data-toggle=tooltip]' });
      });
    </script>
  </body>
</html>