<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Patch 978 - Code::Blocks History</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="../pygments.css">
  </head>
  <body role="document">
    <div class="navbar navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://www.codeblocks.org/">Code::Blocks</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../index.html">Home</a></li>
            <li><a href="../bugs.html">Bugs</a></li>
            <li><a href="../features.html">Features</a></li>
            <li class="active"><a href="../patches.html">Patches</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container" role="main">
      <div class="row">
        <div class="col-sm-8">
          <h3>Patch #978 <small>2006-04-01 13:16</small></h3>
          <h4>dermeister</h4>
          Make Search-&gt;Find and Search-&gt;Find in files more consistent
          <dl class="dl-horizontal">
            <dt>Download</dt>
            <dd><a href="978-Make_Search_Fin.patch">978-Make_Search_Fin.patch</a> (3.1 KB)</dd>
          </dl>
        </div>
        <div class="col-sm-4">
          <dl class="dl-horizontal">
            <dt>Category</dt><dd>Application::Refinement</dd>
            <dt>Status</dt><dd>Closed</dd>
            <dt>Close date</dt><dd>2006-04-24 15:41 <a href="http://cb.biplab.in/websvn/log.php?sr=2377"><span class="glyphicon glyphicon-link"></span></a></dd>
            <dt>Assigned to</dt><dd>tiwag</dd>
          </dl>
        </div>
      </div>
      <div class="highlight"><pre class="pre-scrollable"><span class="gh">Index: src/sdk/finddlg.cpp</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/sdk/finddlg.cpp    (revision 2366)</span>
<span class="gi">+++ src/sdk/finddlg.cpp    (working copy)</span>
<span class="gu">@@ -57,7 +57,7 @@</span>
     EVT_ACTIVATE(                       FindDlg::OnActivate)
 END_EVENT_TABLE()
 
<span class="gd">-FindDlg::FindDlg(wxWindow* parent, const wxString&amp; initial, bool hasSelection, bool findInFilesOnly)</span>
<span class="gi">+FindDlg::FindDlg(wxWindow* parent, const wxString&amp; initial, bool hasSelection, bool findInFilesOnly, bool findInFilesActive)</span>
     : FindReplaceBase(parent, initial, hasSelection),
     m_Complete(!findInFilesOnly)
 {
<span class="gu">@@ -113,6 +113,11 @@</span>
 
     if (!m_Complete)
         XRCCTRL(*this, &quot;nbFind&quot;, wxNotebook)-&gt;DeletePage(0); // no active editor, so only find-in-files
<span class="gi">+    else if (findInFilesActive)</span>
<span class="gi">+    {</span>
<span class="gi">+        XRCCTRL(*this, &quot;nbFind&quot;, wxNotebook)-&gt;SetSelection(1); // Search-&gt;Find in Files was selected</span>
<span class="gi">+        XRCCTRL(*this, &quot;cmbFind2&quot;, wxComboBox)-&gt;SetFocus();</span>
<span class="gi">+    }</span>
 }
 
 FindDlg::~FindDlg()
<span class="gu">@@ -125,9 +130,11 @@</span>
     cfg-&gt;Write(CONF_GROUP _T(&quot;/search_hidden&quot;), XRCCTRL(*this, &quot;chkSearchHidden&quot;, wxCheckBox)-&gt;GetValue());
 
     // save last searches (up to 10)
<span class="gd">-    wxComboBox* combo = XRCCTRL(*this, &quot;cmbFind1&quot;, wxComboBox);</span>
<span class="gd">-    if (!m_Complete)</span>
<span class="gi">+    wxComboBox* combo;</span>
<span class="gi">+    if (IsFindInFiles())</span>
         combo = XRCCTRL(*this, &quot;cmbFind2&quot;, wxComboBox);
<span class="gi">+    else</span>
<span class="gi">+        combo = XRCCTRL(*this, &quot;cmbFind1&quot;, wxComboBox);</span>
     wxArrayString previous;
     for (int i = 0; (i &lt; combo-&gt;GetCount()) &amp;&amp; (i &lt; 10); ++i)
     {
<span class="gu">@@ -311,7 +318,8 @@</span>
 
 void FindDlg::OnActivate(wxActivateEvent&amp; event)
 {
<span class="gd">-    if (!m_Complete &amp;&amp; XRCCTRL(*this, &quot;cmbFind2&quot;, wxComboBox))</span>
<span class="gi">+    // Why is there the second part in the expression? Is this really necessary?</span>
<span class="gi">+    if (IsFindInFiles() &amp;&amp; XRCCTRL(*this, &quot;cmbFind2&quot;, wxComboBox))</span>
         XRCCTRL(*this, &quot;cmbFind2&quot;, wxComboBox)-&gt;SetFocus();
     else
         XRCCTRL(*this, &quot;cmbFind1&quot;, wxComboBox)-&gt;SetFocus();
<span class="gh">Index: src/sdk/finddlg.h</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/sdk/finddlg.h    (revision 2366)</span>
<span class="gi">+++ src/sdk/finddlg.h    (working copy)</span>
<span class="gu">@@ -10,7 +10,7 @@</span>
 class FindDlg : public FindReplaceBase
 {
     public:
<span class="gd">-        FindDlg(wxWindow* parent, const wxString&amp; initial = wxEmptyString, bool hasSelection = false, bool findInFilesOnly = false);</span>
<span class="gi">+        FindDlg(wxWindow* parent, const wxString&amp; initial = wxEmptyString, bool hasSelection = false, bool findInFilesOnly = false, bool findInFilesActive = false);</span>
         ~FindDlg();
         wxString GetFindString() const;
         wxString GetReplaceString() const{ return wxEmptyString; }
<span class="gh">Index: src/sdk/editormanager.cpp</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/sdk/editormanager.cpp    (revision 2366)</span>
<span class="gi">+++ src/sdk/editormanager.cpp    (working copy)</span>
<span class="gu">@@ -1109,7 +1109,7 @@</span>
 
     FindReplaceBase* dlg;
     if (!replace)
<span class="gd">-        dlg = new FindDlg(Manager::Get()-&gt;GetAppWindow(), phraseAtCursor, hasSelection, explicitly_find_in_files || !ed);</span>
<span class="gi">+        dlg = new FindDlg(Manager::Get()-&gt;GetAppWindow(), phraseAtCursor, hasSelection, !ed, explicitly_find_in_files);</span>
     else
         dlg = new ReplaceDlg(Manager::Get()-&gt;GetAppWindow(), phraseAtCursor, hasSelection);
 
</pre></div>

      <h4 class="page-header">History</h4>
      <div class="panel panel-default">
        <div class="panel-heading">dermeister 2006-04-01 13:19</div>
        <div class="panel-body">
          <p>When you open the find-dialog with "Search-&gt;Find" you see both tabs  - one for "Find" and one for "Find in files" - in the dialog and the tab for "Find" is selected.</p>
          <p>But if you open the same dialog with "Search-&gt;Find in files" there is only the tab for "Find in files" even if there is an open editor. It would be better if both tabs are there (as long as there is an open editor) and the tab for "Find in files" should be selected.</p>
          <p>This patch implements this behaviour.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">mandrav 2006-04-05 07:52</div>
        <div class="panel-body">
          <p>Hmm, patch doesn't apply (failed hunks)...</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">dermeister 2006-04-07 15:09</div>
        <div class="panel-body">
          <p>I just updated the patch. It sould now apply to revision 2321.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">tiwag 2006-04-13 12:53</div>
        <div class="panel-body">
          <p>reverted from svn for now, because the provided patch introduces a bug, which prevents the Search-pattern edit control getting the focus. This is only one (visible) bug!</p>
          <p>Other side-effects exist too because the FindDlg::m_Complete flag is used in all event handlers to decide if we are in "Find" or in "Find in Files" mode.</p>
          <p>Will look at this and possibly correct it later ...</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">dermeister 2006-04-20 13:26</div>
        <div class="panel-body">
          <p>As far as I can see only the destructor uses FindDlg::m_Complete to check if Find in Files was selected (should be around line 130 in finddlg.cpp). In my opinion this is *not* correct. The function FindDlg::IsFindInFiles should be used instead because this function does the correct check.</p>
          <p>The current way would even fail if you open the FindDlg with "Search-&gt;Find" and then select the FindInFiles-page.</p>
          <p>The same issue appears in FindDlg::OnActivate. This function sets the focus to the wrong edit control if you do the same thing as described above. Using FindDlg::IsFindInFiles instead of FindDlg::m_Complete should fix this issue.</p>
          <p>One word to the focus bug: It looks like the edit control never gets the focus if you switch between the pages. And that is what the constructor does if my original patch is applied and "Search-&gt;FindInFiles" is selected. Maybe we have to set the focus after the "...-&gt;SetSelection(1);"-line from my patch? Or perhaps set it always to the edit control after someone selects another page?</p>
          <p>I'll take another look at this problem this evening and probably provide another (hopefully better) patch...</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">dermeister 2006-04-20 16:43</div>
        <div class="panel-body">
          <p>OK, looks as if I was right. I made a few changes according to my last comment and it seems to work. I could not reproduce any of the described issues. The patch here is updated and should apply to revision 2366.</p>
          <p>Just an additional note: I'm not sure about the expression in the if-statement in FindDlg::OnActivate. The second part (XCONTROL(... ) looks useless to me - or did I miss something? Maybe some possible race-conditions during construction? But if that's the reason for this check then it should also be checked in the else-branch for the same reason...</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">tiwag 2006-04-24 15:39</div>
        <div class="panel-body">
          <p>ad "I'm not sure about the expression in the if-statement in FindDlg::OnActivate. The second part (XCONTROL(... ) looks useless to me..." :</p>
          <p>this is used to prevent a crash when the dialog wasn't created, this happens when no project or no editor of a project is opened. i recoded this part and added a check for null pointers.</p>
          <p>general:</p>
          <p>there are still a few bugs left,</p>
          <p>* switching between tabs (find) &amp;&amp; (find in files) - the editcontrol doesn't get the focus</p>
          <p>* pressing Ctrl-F or Ctrl-Shift-F without active project - the dialog appears (should not) - but it doesn't crash C::B ;-)</p>
          <p>* some occurances of m_Complete are left</p>
          <p>from my point of view the Handling with IsFindInFiles() and Complete is still buggy - we would need both flags as private flags for example (bool m_findInFilesOnly, bool m_findInFilesActive) in order to clean up all possibilities, but i don't care at the moment.</p>
          <p>@dermeister: if you have time please clean it up</p>
          <p>your patch is commited to svn rev 2373</p>
          <p>thanks for your patch</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">dermeister 2006-04-24 17:19</div>
        <div class="panel-body">
          <p>"* switching between tabs (find) &amp;&amp; (find in files) - the editcontrol doesn't get the focus"</p>
          <p>Yes, but I think this was the case before, too. I didn't see any code that handles the switching between the tabs to set the focus to the edit control. Maybe we should add this?</p>
          <p>"* pressing Ctrl-F or Ctrl-Shift-F without active project - the dialog appears (should not) - but it doesn't crash C::B ;-)"</p>
          <p>Well - I did not test this. Does this also happen without this patch? And which dialog should not appear? The find-dialog? The find-in-files-dialog? Or Both? Personally I would say that "find in files" should even work without any project and "find" should work only with open editors - no matter if there is an open project.</p>
          <p>"* some occurances of m_Complete are left"</p>
          <p>Yes, but they are there to see if the "find" tab is there or not - they are not used to check which tab is active! Thus, these occurances *must* stay...</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">dermeister 2006-04-24 17:23</div>
        <div class="panel-body">
          <p>"from my point of view the Handling with IsFindInFiles() and Complete is still buggy - we would need both flags as private flags for example (bool m_findInFilesOnly, bool m_findInFilesActive) in order to clean up all possibilities, but i don't care at the moment.</p>
          <p>@dermeister: if you have time please clean it up"</p>
          <p>Well, I will have a look at this but I fear I don't have the  time in the next two weeks... sorry for that...</p>
        </div>
      </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
  </body>
</html>
