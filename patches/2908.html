<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Patch 2908 - Code::Blocks History</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css">
  </head>
  <body role="document">
    <div class="navbar navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://www.codeblocks.org/">Code::Blocks</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../index.html">Home</a></li>
            <li><a href="../bugs.html">Bugs</a></li>
            <li><a href="../features.html">Features</a></li>
            <li class="active"><a href="../patches.html">Patches</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container" role="main">
      <div class="row">
        <div class="col-sm-8">
          <h3>Patch #2908 <small>2010-01-19 04:01</small></h3>
          <h4>terryp</h4>
          Try MINE before internal editor, on double click of files
          <dl class="dl-horizontal">
            <dt>Download</dt>
            <dd><a href="2908-Try_MINE_befor.patch">2908-Try_MINE_befor.patch</a> (5.7 KB)</dd>
          </dl>
        </div>
        <div class="col-sm-4">
          <dl class="dl-horizontal">
            <dt>Category</dt><dd>Application::Refinement</dd>
            <dt>Status</dt><dd>Out of date</dd>
            <dt>Close date</dt><dd>2011-11-24 12:27</dd>
            <dt>Assigned to</dt><dd>mortenmacfly</dd>
          </dl>
        </div>
      </div>
      <div class="highlight"><pre class="pre-scrollable"><span class="gh">Index: debian/changelog</span>
<span class="gh">===================================================================</span>
<span class="gd">--- debian/changelog    (revision 6089)</span>
<span class="gi">+++ debian/changelog    (working copy)</span>
<span class="gu">@@ -1,4 +1,4 @@</span>
<span class="gd">-codeblocks (8.02svn5933) unstable; urgency=low</span>
<span class="gi">+codeblocks (8.02svn6089) unstable; urgency=low</span>
 
   * more fixes to debian build system, sources and packages are now
     lintian-clean, except for some words guessed as spelling-errors.
<span class="gh">Index: src/sdk/projectmanager.cpp</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/sdk/projectmanager.cpp    (revision 6089)</span>
<span class="gi">+++ src/sdk/projectmanager.cpp    (working copy)</span>
<span class="gu">@@ -1437,50 +1437,49 @@</span>
     }
 
     FileType ft = FileTypeOf(filename);
<span class="gd">-    if (ft == ftHeader || ft == ftSource)</span>
<span class="gi">+</span>
<span class="gi">+    // first look for custom editors</span>
<span class="gi">+    // if that fails, try MIME handlers</span>
<span class="gi">+    EditorBase* eb = Manager::Get()-&gt;GetEditorManager()-&gt;IsOpen(filename);</span>
<span class="gi">+    if (eb &amp;&amp; !eb-&gt;IsBuiltinEditor())</span>
     {
<span class="gd">-        // C/C++ header/source files, always get opened inside Code::Blocks</span>
<span class="gd">-        cbEditor* ed = Manager::Get()-&gt;GetEditorManager()-&gt;Open(filename);</span>
<span class="gd">-        if (ed)</span>
<span class="gd">-        {</span>
<span class="gd">-            ed-&gt;SetProjectFile(pf);</span>
<span class="gd">-            ed-&gt;Activate();</span>
<span class="gd">-        }</span>
<span class="gd">-        else</span>
<span class="gd">-        {</span>
<span class="gd">-            wxString msg;</span>
<span class="gd">-            msg.Printf(_(&quot;Failed to open &#39;%s&#39;.&quot;), filename.c_str());</span>
<span class="gd">-            Manager::Get()-&gt;GetLogManager()-&gt;LogError(msg);</span>
<span class="gd">-        }</span>
<span class="gi">+        // custom editors just get activated</span>
<span class="gi">+        eb-&gt;Activate();</span>
<span class="gi">+        return;</span>
     }
<span class="gd">-    else</span>
<span class="gi">+</span>
<span class="gi">+    // then try MIME handlers</span>
<span class="gi">+    cbMimePlugin* plugin = Manager::Get()-&gt;GetPluginManager()-&gt;GetMIMEHandlerForFile(filename);</span>
<span class="gi">+    if (!plugin)</span>
     {
<span class="gd">-        // first look for custom editors</span>
<span class="gd">-        // if that fails, try MIME handlers</span>
<span class="gd">-        EditorBase* eb = Manager::Get()-&gt;GetEditorManager()-&gt;IsOpen(filename);</span>
<span class="gd">-        if (eb &amp;&amp; !eb-&gt;IsBuiltinEditor())</span>
<span class="gi">+        if (ft == ftHeader || ft == ftSource)</span>
         {
<span class="gd">-            // custom editors just get activated</span>
<span class="gd">-            eb-&gt;Activate();</span>
<span class="gd">-            return;</span>
<span class="gi">+            // try falling back on the internal editor before</span>
<span class="gi">+            // resorting to an error message.</span>
<span class="gi">+            cbEditor* ed = Manager::Get()-&gt;GetEditorManager()-&gt;Open(filename);</span>
<span class="gi">+            if (ed)</span>
<span class="gi">+            {</span>
<span class="gi">+                ed-&gt;SetProjectFile(pf);</span>
<span class="gi">+                ed-&gt;Activate();</span>
<span class="gi">+            }</span>
<span class="gi">+            else</span>
<span class="gi">+            {</span>
<span class="gi">+                wxString msg;</span>
<span class="gi">+                msg.Printf(_(&quot;Failed to open &#39;%s&#39;.&quot;), filename.c_str());</span>
<span class="gi">+                Manager::Get()-&gt;GetLogManager()-&gt;LogError(msg);</span>
<span class="gi">+            }</span>
         }
<span class="gd">-</span>
<span class="gd">-        // not a recognized file type</span>
<span class="gd">-        cbMimePlugin* plugin = Manager::Get()-&gt;GetPluginManager()-&gt;GetMIMEHandlerForFile(filename);</span>
<span class="gd">-        if (!plugin)</span>
<span class="gd">-        {</span>
<span class="gd">-            wxString msg;</span>
<span class="gd">-            msg.Printf(_(&quot;Could not open file &#39;%s&#39;.\nNo handler registered for this type of file.&quot;), filename.c_str());</span>
<span class="gd">-            Manager::Get()-&gt;GetLogManager()-&gt;LogError(msg);</span>
<span class="gd">-        }</span>
<span class="gd">-        else if (plugin-&gt;OpenFile(filename) != 0)</span>
<span class="gd">-        {</span>
<span class="gd">-            const PluginInfo* info = Manager::Get()-&gt;GetPluginManager()-&gt;GetPluginInfo(plugin);</span>
<span class="gd">-            wxString msg;</span>
<span class="gd">-            msg.Printf(_(&quot;Could not open file &#39;%s&#39;.\nThe registered handler (%s) could not open it.&quot;), filename.c_str(), info ? info-&gt;title.c_str() : wxString(_(&quot;&lt;Unknown plugin&gt;&quot;)).c_str());</span>
<span class="gd">-            Manager::Get()-&gt;GetLogManager()-&gt;LogError(msg);</span>
<span class="gd">-        }</span>
<span class="gi">+        wxString msg;</span>
<span class="gi">+        msg.Printf(_(&quot;Could not open file &#39;%s&#39;.\nNo handler registered for this type of file.&quot;), filename.c_str());</span>
<span class="gi">+        Manager::Get()-&gt;GetLogManager()-&gt;LogError(msg);</span>
     }
<span class="gi">+    else if (plugin-&gt;OpenFile(filename) != 0)</span>
<span class="gi">+    {</span>
<span class="gi">+        const PluginInfo* info = Manager::Get()-&gt;GetPluginManager()-&gt;GetPluginInfo(plugin);</span>
<span class="gi">+        wxString msg;</span>
<span class="gi">+        msg.Printf(_(&quot;Could not open file &#39;%s&#39;.\nThe registered handler (%s) could not open it.&quot;), filename.c_str(), info ? info-&gt;title.c_str() : wxString(_(&quot;&lt;Unknown plugin&gt;&quot;)).c_str());</span>
<span class="gi">+        Manager::Get()-&gt;GetLogManager()-&gt;LogError(msg);</span>
<span class="gi">+    }</span>
 }
 
 void ProjectManager::DoOpenSelectedFile()
<span class="gh">Index: src/src/main.cpp</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/src/main.cpp    (revision 6089)</span>
<span class="gi">+++ src/src/main.cpp    (working copy)</span>
<span class="gu">@@ -1566,25 +1566,28 @@</span>
             }
         }
         //
<span class="gd">-        // Source files</span>
<span class="gd">-        //</span>
<span class="gd">-        case ftHeader:</span>
<span class="gd">-            // fallthrough</span>
<span class="gd">-        case ftSource:</span>
<span class="gd">-            // fallthrough</span>
<span class="gd">-        case ftResource:</span>
<span class="gd">-            return DoOpenFile(filename, addToHistory);</span>
<span class="gd">-        //</span>
         // For all other files, ask MIME plugin for a suitable handler
         //
         default:
         {
             cbMimePlugin* plugin = Manager::Get()-&gt;GetPluginManager()-&gt;GetMIMEHandlerForFile(filename);
<span class="gd">-            // warn user that &quot;Files extension handler&quot; is disabled</span>
<span class="gi">+            // attempt fall back on the internal editor</span>
             if (!plugin)
             {
<span class="gd">-                cbMessageBox(_(&quot;Could not open file &quot;) +</span>
<em><strong>file truncated...</strong></em>
</pre></div>

      <h4 class="page-header">History</h4>
      <div class="panel panel-default">
        <div class="panel-heading">terryp 2010-01-19 04:04</div>
        <div class="panel-body">
          <p>This makes double clicking a file in the project manager open using the users file extension/mime handlers, even when they're already known to Code::Blocks as source/header files. Which is exactly what a user would expect the IDE to do!</p>
          <p>Note however that making C::B behave similarly when dealing with build messages / etc, would require more in depth changes, or just uglification of a couple functions.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">mortenmacfly 2010-02-25 14:15</div>
        <div class="panel-body">
          <p>I doubt this will be applied any time soon.</p>
          <p>After it's application Code::Blocks will ask for every file (including *.c, *.cpp etc.) how to open.</p>
          <p>Code::Blocks is a C / C++ IDE, so nobody will expect it asks what to do with a C / C++ file. That's really not convenient to me.</p>
          <p>No other C / C++ IDE I know will ask how to operate a C / C++ file. What makes you say "Which is exactly what a user would expect the IDE to do!"? I doubt this is true.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">terryp 2010-02-25 16:57</div>
        <div class="panel-body">
          <p>Ahh, sorry, looks like the MIME stuff must be taking it upon itself to prompt the user for what to do when there's no MIME type set, making the fall backs on the internals virtually a no-op. I didn't notice that.</p>
          <p>When I have the free time, I'll resync my working copy with the trunk, and experiment with fixing that. It should only take a few bytes in changes, unless Code::Blocks' architecture purposely makes both sane and proper behavior near impossible :-o.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">mortenmacfly 2011-08-13 05:13</div>
        <div class="panel-body">
          <p>Any news on that? I'd close the patch otherwise.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">mortenmacfly 2011-11-24 12:27</div>
        <div class="panel-body">
          <p>No activity - invalidating.</p>
        </div>
      </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
  </body>
</html>
