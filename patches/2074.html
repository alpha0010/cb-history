<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Patch 2074 - Code::Blocks History</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="../pygments.css">
  </head>
  <body role="document">
    <div class="navbar navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://www.codeblocks.org/">Code::Blocks</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../index.html">Home</a></li>
            <li><a href="../bugs.html">Bugs</a></li>
            <li><a href="../features.html">Features</a></li>
            <li class="active"><a href="../patches.html">Patches</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container" role="main">
      <div class="row">
        <div class="col-sm-8">
          <h3>Patch #2074 <small>2007-06-22 15:23</small></h3>
          <h4>dmoore</h4>
          keybinder/main menu options for CC options
          <dl class="dl-horizontal">
            <dt>Download</dt>
            <dd><a href="2074-keybinder_main.patch">2074-keybinder_main.patch</a> (5.9 KB)</dd>
          </dl>
        </div>
        <div class="col-sm-4">
          <dl class="dl-horizontal">
            <dt>Category</dt><dd>Application::FeatureAdd</dd>
            <dt>Status</dt><dd>Open</dd>
            <dt>Close date</dt><dd>&nbsp;</dd>
            <dt>Assigned to</dt><dd>dmoore</dd>
          </dl>
        </div>
      </div>
      <div class="highlight"><pre class="pre-scrollable"><span class="gh">Index: src/plugins/codecompletion/codecompletion.cpp</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/plugins/codecompletion/codecompletion.cpp    (revision 4149)</span>
<span class="gi">+++ src/plugins/codecompletion/codecompletion.cpp    (working copy)</span>
<span class="gu">@@ -109,6 +109,9 @@</span>
 int idGotoDeclaration = wxNewId();
 int idGotoImplementation = wxNewId();
 int idOpenIncludeFile = wxNewId();
<span class="gi">+int idGotoDeclarationMenu = wxNewId();</span>
<span class="gi">+int idGotoImplementationMenu = wxNewId();</span>
<span class="gi">+int idOpenIncludeFileMenu = wxNewId();</span>
 int idStartParsingProjects = wxNewId();
 int idCodeCompleteTimer = wxNewId();
 int idFunctionsParsingTimer = wxNewId();
<span class="gu">@@ -128,7 +131,10 @@</span>
     EVT_MENU(idUnimplementedClassMethods, CodeCompletion::OnUnimplementedClassMethods)
     EVT_MENU(idGotoDeclaration, CodeCompletion::OnGotoDeclaration)
     EVT_MENU(idGotoImplementation, CodeCompletion::OnGotoDeclaration)
<span class="gi">+    EVT_MENU(idGotoDeclarationMenu, CodeCompletion::OnGotoDeclarationMenu)</span>
<span class="gi">+    EVT_MENU(idGotoImplementationMenu, CodeCompletion::OnGotoDeclarationMenu)</span>
     EVT_MENU(idOpenIncludeFile, CodeCompletion::OnOpenIncludeFile)
<span class="gi">+    EVT_MENU(idOpenIncludeFileMenu, CodeCompletion::OnOpenIncludeFileMenu)</span>

     EVT_MENU(idViewClassBrowser, CodeCompletion::OnViewClassBrowser)

<span class="gu">@@ -237,6 +243,8 @@</span>
         m_EditMenu-&gt;AppendSeparator();
         m_EditMenu-&gt;Append(idMenuCodeComplete, _(&quot;Complete code\tCtrl-Space&quot;));
         m_EditMenu-&gt;Append(idMenuShowCallTip, _(&quot;Show call tip\tCtrl-Shift-Space&quot;));
<span class="gi">+        m_EditMenu-&gt;Append(idClassMethod, _(&quot;Insert class method declaration/implementation&quot;));</span>
<span class="gi">+        m_EditMenu-&gt;Append(idUnimplementedClassMethods, _(&quot;Insert unimplemented class methods&quot;));</span>
     }
     else
         Manager::Get()-&gt;GetMessageManager()-&gt;DebugLog(_T(&quot;Could not find Edit menu!&quot;));
<span class="gu">@@ -247,6 +255,9 @@</span>
         m_SearchMenu-&gt;Append(idMenuGotoFunction, _(&quot;Goto function...\tCtrl-Alt-G&quot;));
         m_SearchMenu-&gt;Append(idMenuGotoPrevFunction, _(&quot;Goto previous function\tCtrl-PgUp&quot;));
         m_SearchMenu-&gt;Append(idMenuGotoNextFunction, _(&quot;Goto next function\tCtrl-PgDn&quot;));
<span class="gi">+        m_SearchMenu-&gt;Append(idGotoDeclarationMenu, _(&quot;Goto declaration&quot;));</span>
<span class="gi">+        m_SearchMenu-&gt;Append(idGotoImplementationMenu, _(&quot;Goto implementation&quot;));</span>
<span class="gi">+        m_SearchMenu-&gt;Append(idOpenIncludeFileMenu, _(&quot;Open include file&quot;));</span>
     }
     else
         Manager::Get()-&gt;GetMessageManager()-&gt;DebugLog(_T(&quot;Could not find Search menu!&quot;));
<span class="gu">@@ -402,12 +415,17 @@</span>
     {
         m_EditMenu-&gt;Delete(idMenuCodeComplete);
         m_EditMenu-&gt;Delete(idMenuShowCallTip);
<span class="gi">+        m_EditMenu-&gt;Delete(idClassMethod);</span>
<span class="gi">+        m_EditMenu-&gt;Delete(idUnimplementedClassMethods);</span>
     }
     if (m_SearchMenu)
     {
         m_SearchMenu-&gt;Delete(idMenuGotoFunction);
         m_SearchMenu-&gt;Delete(idMenuGotoPrevFunction);
         m_SearchMenu-&gt;Delete(idMenuGotoNextFunction);
<span class="gi">+        m_SearchMenu-&gt;Delete(idGotoDeclarationMenu);</span>
<span class="gi">+        m_SearchMenu-&gt;Delete(idGotoImplementationMenu);</span>
<span class="gi">+        m_SearchMenu-&gt;Delete(idOpenIncludeFileMenu);</span>
     }
 }

<span class="gu">@@ -1364,6 +1382,8 @@</span>
     {
         m_EditMenu-&gt;Enable(idMenuCodeComplete, hasEd);
         m_EditMenu-&gt;Enable(idMenuShowCallTip, hasEd);
<span class="gi">+        m_EditMenu-&gt;Enable(idClassMethod, hasEd);</span>
<span class="gi">+        m_EditMenu-&gt;Enable(idUnimplementedClassMethods, hasEd);</span>
     }

     if (m_SearchMenu)
<span class="gu">@@ -1371,6 +1391,9 @@</span>
         m_SearchMenu-&gt;Enable(idMenuGotoFunction,     hasEd);
         m_SearchMenu-&gt;Enable(idMenuGotoPrevFunction, hasEd);
         m_SearchMenu-&gt;Enable(idMenuGotoNextFunction, hasEd);
<span class="gi">+        m_SearchMenu-&gt;Enable(idGotoDeclarationMenu, hasEd);</span>
<span class="gi">+        m_SearchMenu-&gt;Enable(idGotoImplementationMenu, hasEd);</span>
<span class="gi">+        m_SearchMenu-&gt;Enable(idOpenIncludeFileMenu, hasEd);</span>
     }

     if (m_ViewMenu)
<span class="gu">@@ -1463,11 +1486,57 @@</span>
     DoAllMethodsImpl();
 }

<span class="gi">+void CodeCompletion::OnOpenIncludeFileMenu(wxCommandEvent&amp; event)</span>
<span class="gi">+{</span>
<span class="gi">+    cbEditor* ed = Manager::Get()-&gt;GetEditorManager()-&gt;GetBuiltinActiveEditor();</span>
<span class="gi">+    if (ed)</span>
<span class="gi">+    {</span>
<span class="gi">+        m_LastIncludeFileFrom = ed-&gt;GetFilename();</span>
<span class="gi">+        cbStyledTextCtrl* control = ed-&gt;GetControl();</span>
<span class="gi">+        int pos = control-&gt;GetCurrentPos();</span>
<span class="gi">+        wxString line = control-&gt;GetLine(control-&gt;LineFromPosition(pos));</span>
<span class="gi">+</span>
<span class="gi">+        wxRegEx reg(_T(&quot;^[ \t]*#[ \t]*include[ \t]+[\&quot;&lt;]([^\&quot;&gt;]+)[\&quot;&gt;]&quot;));</span>
<span class="gi">+        wxString inc;</span>
<span class="gi">+        if (reg.Matches(line))</span>
<span class="gi">+            inc = reg.GetMatch(line, 1);</span>
<span class="gi">+        m_LastIncludeFile.Clear();</span>
<span class="gi">+        if (!inc.IsEmpty())</span>
<span class="gi">+        {</span>
<span class="gi">+            m_LastIncludeFile = inc;</span>
<span class="gi">+            OnOpenIncludeFile(event);</span>
<span class="gi">+        }</span>
<span class="gi">+    }</span>
<span class="gi">+}</span>
<span class="gi">+</span>
<span class="gi">+void CodeCompletion::OnGotoDeclarationMenu(wxCommandEvent&amp; event)</span>
<span class="gi">+{</span>
<span class="gi">+    cbEditor* ed = Manager::Get()-&gt;GetEditorManager()-&gt;GetBuiltinActiveEditor();</span>
<span class="gi">+    if (ed)</span>
<span class="gi">+    {</span>
<span class="gi">+        cbStyledTextCtrl* control = ed-&gt;GetControl();</span>
<span class="gi">+        int pos = control-&gt;GetCurrentPos();</span>
<span class="gi">+        int ws = control-&gt;WordStartPosition(pos, true);</span>
<span class="gi">+        int we = control-&gt;WordEndPosition(pos, true);</span>
<span class="gi">+        wxString txt = control-&gt;GetTextRange(ws, we);</span>
<span class="gi">+        m_LastKeyword.Clea</span>
<em><strong>download for full patch...</strong></em>
</pre></div>

      <h4 class="page-header">History</h4>
      <div class="panel panel-default">
        <div class="panel-heading">dmoore 2007-06-22 15:23</div>
        <div class="panel-body">
          <p>per discussion at <a href="http://forums.codeblocks.org/index.php/topic,6208.msg47801.html#msg47801" data-toggle="tooltip" title="[Suggestion]&quot;Find&quot; function improvement">http://forums.codeblocks.org/index.php/topic,6208.msg47801.html#msg47801</a></p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">dmoore 2007-06-22 15:25</div>
        <div class="panel-body">
          <p>title should of this patch should have read "... for CC commands"</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">mandrav 2007-06-25 11:53</div>
        <div class="panel-body">
          <p>I am not sure these are valid items to add to the menus. They are very content-specific (i.e. what the text under the cursor is).</p>
          <p>From what I understand, you did this patch just to be able to configure the shortcuts for these options through keybinder, no?</p>
          <p>If that's the case, maybe we should just think of a better way to handle shortcuts. Cluttering the application menus just so keybinder can change the various shortcuts is the wrong approach IMO.</p>
          <p>We will have to think of a way to "register" commands (or actions if you prefer) to a central place so their shortcuts can also be configured centrally.</p>
          <p>I did start writing an actions-manager once for this very reason but I stopped working on it at some point and now I can't even find the sources... No big deal though as that was a fairly complcated piece of code (managed the creation of menus/toolbars too), while we 're after something simpler.</p>
          <p>So, unless someone has a different opinion/proposition, I suggest that this patch is rejected and a discussion be started (at the forums) for managing the shortcuts issue centrally.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">dmoore 2007-06-25 13:51</div>
        <div class="panel-body">
          <p>Personally, I don't care whether this patch is accepted or not, I was just responding to a user request (and I'd just spent a bunch of time working with the CC plugin so it was a minor effort).</p>
          <p>Everything on the edit menu is context specific (also some of the search menu). I agree it's a little clumsy and that it would be very nice to have the SDK provide some sort of key/menu registry. the only problem is that context menus are dynamic so I think there will be quite a bit of work involved: a right click gives plugins the opportunity to tell the app what actions are appropriate for this context (at the same time the app sends data about the item clicked). With keystrokes, there is no opportunity to pre-fetch so you will need to send the data to the plugin after the keystroke.</p>
          <p>IMO you should wait until post 1.0 and re-implement the more complicated "action-manager" you referred to, so action registration, menus, toolbars and keyboard shortcuts can be handled in a consistent, graceful way.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">mandrav 2007-06-27 07:23</div>
        <div class="panel-body">
          <p>&gt;&gt;&gt; IMO you should wait until post 1.0 and re-implement the more complicated "action-manager" you referred to, so action registration, menus, toolbars and keyboard shortcuts can be handled in a consistent, graceful way.</p>
          <p>That was the plan. But with the sources gone, I don't think I 'm going to re-implement the "complex" action manager :).</p>
          <p>I was merely talking about a "shortucts registry" of sorts...</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">dmoore 2007-07-18 23:55</div>
        <div class="panel-body">
          <p>&gt;&gt;&gt; But with the sources gone, I don't think I 'm going to re-implement the "complex" action manager :).</p>
          <p>Mandrav: I wouldn't mind taking a shot at this (for post v1.0). I'm thinking every plugin (plus the main app) should register all of its commands with a "MenuMgr" with details for each item including</p>
          <p>* name</p>
          <p>* icon</p>
          <p>* id and/or callback</p>
          <p>* default sub menu it appears in if it is a main menu command (need to be flexible enough to offer nested menu structures)</p>
          <p>* list (bit-field) of context menu it appears in if it is a context driven command (should allow plugins to register their own context menus as candidates? e.g. my file explorer plugin)</p>
          <p>* default keystroke</p>
          <p>* supported states (enable/disable, check/uncheck etc)</p>
          <p>MenuMgr will provide methods to enable/disable commands, move commands to different menus, change the ordering of context menu commands (including creation of context menu submenus), change keystroke etc.</p>
          <p>For context menu commands, BuildModuleMenu will still be called, but it will ask plugins to _confirm_ whether their registered commands will be shown (or in the case of keystrokes, reject the keystroke if certain conditions aren't met)</p>
          <p>The benefit of this will be a more user customisable experience (with respect to menu placement and keystrokes) but the cost will be quite a lot of changes to existing menuing code.</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">killerbot 2008-06-18 20:00</div>
        <div class="panel-body">
          <p>all parts except the classwizard has been implemented (that means : find decleration/implementation and open include file)</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">dmoore 2012-10-23 11:14</div>
        <div class="panel-body">
          <p>Indeed, I have started working on this. Still figuring out what is required, so will probably take a few more weeks. (Cringes at sight of 5 year old bug.)</p>
        </div>
      </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script>
      $(document).ready(function() {
        $("body").tooltip({ selector: '[data-toggle=tooltip]' });
      });
    </script>
  </body>
</html>
