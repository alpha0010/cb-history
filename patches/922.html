<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Patch 922 - Code::Blocks History</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="../pygments.css">
  </head>
  <body role="document">
    <div class="navbar navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://www.codeblocks.org/">Code::Blocks</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../index.html">Home</a></li>
            <li><a href="../bugs.html">Bugs</a></li>
            <li><a href="../features.html">Features</a></li>
            <li class="active"><a href="../patches.html">Patches</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container" role="main">
      <div class="row">
        <div class="col-sm-8">
          <h3>Patch #922 <small>2006-03-13 21:20</small></h3>
          <h4>yop</h4>
          Added distclean for custom makefile projects
          <dl class="dl-horizontal">
            <dt>Download</dt>
            <dd><a href="922-Added_distclean.patch">922-Added_distclean.patch</a> (3.2 KB)</dd>
          </dl>
        </div>
        <div class="col-sm-4">
          <dl class="dl-horizontal">
            <dt>Category</dt><dd>Plugin::FeatureAdd</dd>
            <dt>Status</dt><dd>Accepted</dd>
            <dt>Close date</dt><dd>2006-03-22 13:13 <a href="http://cb.biplab.in/websvn/log.php?sr=2226"><span class="glyphicon glyphicon-link"></span></a></dd>
            <dt>Assigned to</dt><dd>&nbsp;</dd>
          </dl>
        </div>
      </div>
      <div class="highlight"><pre class="pre-scrollable"><span class="gh">Index: src/sdk/cbplugin.h</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/sdk/cbplugin.h    (revision 2189)</span>
<span class="gi">+++ src/sdk/cbplugin.h    (working copy)</span>
<span class="gu">@@ -234,6 +234,19 @@</span>
         /** Same as Clean(ProjectBuildTarget*) but with a wxString argument. */
         virtual int Clean(const wxString&amp; target) = 0;
 
<span class="gi">+        /** @brief DistClean the project/target.</span>
<span class="gi">+          *</span>
<span class="gi">+          * DistClean will typically remove any config files</span>
<span class="gi">+          * and anything else that got created as part of</span>
<span class="gi">+          * building a software package.</span>
<span class="gi">+          *</span>
<span class="gi">+          * @param target The specific build target to &quot;distclean&quot;. If NULL, it</span>
<span class="gi">+          * cleans all the build targets of the current project.</span>
<span class="gi">+          */</span>
<span class="gi">+        virtual int DistClean(ProjectBuildTarget* target = 0L) = 0;</span>
<span class="gi">+        /** Same as DistClean(ProjectBuildTarget*) but with a wxString argument. */</span>
<span class="gi">+        virtual int DistClean(const wxString&amp; target) = 0;</span>
<span class="gi">+</span>
         /** @brief Build the project/target.
           *
           * @param target The specific build target to build. If NULL, it
<span class="gh">Index: src/plugins/compilergcc/compilergcc.h</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/plugins/compilergcc/compilergcc.h    (revision 2189)</span>
<span class="gi">+++ src/plugins/compilergcc/compilergcc.h    (working copy)</span>
<span class="gu">@@ -67,6 +67,8 @@</span>
         virtual int RunSingleFile(const wxString&amp; filename);
         virtual int Clean(ProjectBuildTarget* target = 0L);
         virtual int Clean(const wxString&amp; target);
<span class="gi">+        virtual int DistClean(ProjectBuildTarget* target = 0L);</span>
<span class="gi">+        virtual int DistClean(const wxString&amp; target);</span>
         virtual int Build(ProjectBuildTarget* target = 0L);
         virtual int Build(const wxString&amp; target);
         virtual int Rebuild(ProjectBuildTarget* target = 0L);
<span class="gh">Index: src/plugins/compilergcc/compilergcc.cpp</span>
<span class="gh">===================================================================</span>
<span class="gd">--- src/plugins/compilergcc/compilergcc.cpp    (revision 2189)</span>
<span class="gi">+++ src/plugins/compilergcc/compilergcc.cpp    (working copy)</span>
<span class="gu">@@ -1590,6 +1590,43 @@</span>
     return 0;
 }
 
<span class="gi">+int CompilerGCC::DistClean(const wxString&amp; target)</span>
<span class="gi">+{</span>
<span class="gi">+    if (!CheckProject())</span>
<span class="gi">+        return -1;</span>
<span class="gi">+    return DistClean(m_Project-&gt;GetBuildTarget(target.IsEmpty() ? m_LastTargetName : target));</span>
<span class="gi">+}</span>
<span class="gi">+</span>
<span class="gi">+int CompilerGCC::DistClean(ProjectBuildTarget* target)</span>
<span class="gi">+{</span>
<span class="gi">+    // make sure all project files are saved</span>
<span class="gi">+    if (m_Project &amp;&amp; !m_Project-&gt;SaveAllFiles())</span>
<span class="gi">+        Manager::Get()-&gt;GetMessageManager()-&gt;Log(_(&quot;Could not save all files...&quot;));</span>
<span class="gi">+</span>
<span class="gi">+    DoPrepareQueue();</span>
<span class="gi">+    if (!CompilerValid(target))</span>
<span class="gi">+        return -1;</span>
<span class="gi">+</span>
<span class="gi">+//    Manager::Get()-&gt;GetMacrosManager()-&gt;Reset();</span>
<span class="gi">+</span>
<span class="gi">+    if (m_Project)</span>
<span class="gi">+        wxSetWorkingDirectory(m_Project-&gt;GetBasePath());</span>
<span class="gi">+    CompilerFactory::GetCompiler(m_CompilerId)-&gt;Init(m_Project);</span>
<span class="gi">+</span>
<span class="gi">+    if (UseMake(target))</span>
<span class="gi">+    {</span>
<span class="gi">+        wxString cmd = GetMakeCommandFor(mcDistClean, target);</span>
<span class="gi">+        m_CommandQueue.Add(new CompilerCommand(cmd, wxEmptyString, m_Project, target));</span>
<span class="gi">+        return DoRunQueue();</span>
<span class="gi">+    }</span>
<span class="gi">+    else</span>
<span class="gi">+    {</span>
<span class="gi">+        NotImplemented(_T(&quot;CompilerGCC::Distclean() without a custom Makefile&quot;));</span>
<span class="gi">+        return -1;</span>
<span class="gi">+    }</span>
<span class="gi">+    return 0;</span>
<span class="gi">+}</span>
<span class="gi">+</span>
 void CompilerGCC::OnExportMakefile(wxCommandEvent&amp; event)
 {
     cbMessageBox(_(&quot;This functionality has been temporarily removed from Code::Blocks.\n&quot;
</pre></div>

      <h4 class="page-header">History</h4>
      <div class="panel panel-default">
        <div class="panel-heading">yop 2006-03-13 21:30</div>
        <div class="panel-body">
          <p>This is more like a feature request.</p>
          <p>What it does: it adds support for distcleaning a project / target that uses custom Makefiles. The gui hasn't changed at all (it is easy to but I didn't want to mess up with more than the absolutely necessary). Support for distcleaning using the C::B build system isn't necessery as it would be exactly the same as clean (no autogenerated files etc.) but since I've been working with the Qt plugin, the only way to switch compilers for a project that has already been built is distcleaning it. I see that there is an option to specify the distclean commands in the target/project build options but distcleaning wasn't supported by the actual plugin. Also mcDistClean is also there so I guess it is something that was in your mind but never got developed.</p>
        </div>
      </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
  </body>
</html>
